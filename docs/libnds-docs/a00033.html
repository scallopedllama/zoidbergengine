<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>libnds: Graphics/3D/nehe/lesson10b/source/nehe10b.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="docs.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Graphics/3D/nehe/lesson10b/source/nehe10b.cpp</h1><div class="fragment"><pre class="fragment"><span class="comment">/****************************************</span>
<span class="comment"> *      NDS NeHe Lesson 10b             *</span>
<span class="comment"> *      Author: Dovoto                  *</span>
<span class="comment"> ****************************************/</span>

<span class="comment">// include your ndslib</span>
<span class="preprocessor">#include &lt;<a class="code" href="a00119.html" title="the master include file for nds applications.">nds.h</a>&gt;</span>
<span class="preprocessor">#include &lt;malloc.h&gt;</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>

<span class="comment">//needed to load pcx files</span>
<span class="preprocessor">#include &lt;<a class="code" href="a00107.html" title="An image abstraction for working with image data.">nds/arm9/image.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="a00134.html" title="fixed point trig functions. Angle can be in the range of -32768 to 32767. There are...">nds/arm9/trig_lut.h</a>&gt;</span>


<span class="preprocessor">#include &quot;Mud_pcx.h&quot;</span>
<span class="preprocessor">#include &quot;World_txt.h&quot;</span>


<span class="keywordtype">int</span> DrawGLScene();

<span class="keywordtype">int</span> heading;
<a name="a0"></a><a class="code" href="a00121.html#ab7903878916593daecbeb95b98115ab0" title="32 bit signed integer.">int32</a> xpos;
<a class="code" href="a00121.html#ab7903878916593daecbeb95b98115ab0" title="32 bit signed integer.">int32</a> zpos;

<span class="keywordtype">int</span> yrot;               <span class="comment">// Y Rotation</span>
<a class="code" href="a00121.html#ab7903878916593daecbeb95b98115ab0" title="32 bit signed integer.">int32</a> walkbias = 0;
<span class="keywordtype">int</span> walkbiasangle = 0;
<span class="keywordtype">int</span> lookupdown = 0;


<span class="keywordtype">int</span> texture[0];         <span class="comment">// Storage For 1 Textures (only going to use 1 on the DS for this demo)</span>

<span class="keyword">typedef</span> <span class="keyword">struct </span>tagVERTEX
{
    <a name="a1"></a><a class="code" href="a00136.html#a44a01f8e557971ded510967ffc18e7ff" title="vertex 4.12 fixed format">v16</a> x, y, z;
    <a name="a2"></a><a class="code" href="a00136.html#ae5f96f1b78a6d76787a9f0a9fe9d3164" title="text coordinate 12.4 fixed point">t16</a> u, v;
} VERTEX;

<span class="keyword">typedef</span> <span class="keyword">struct </span>tagTRIANGLE
{
    VERTEX vertex[3];
} TRIANGLE;

<span class="keyword">typedef</span> <span class="keyword">struct </span>tagSECTOR
{
    <span class="keywordtype">int</span> numtriangles;
    TRIANGLE* triangle;
} SECTOR;

  SECTOR sector1;               <span class="comment">// Our Model Goes Here:</span>



 <a name="a3"></a><a class="code" href="a00121.html#a92c50087ca0e64fa93fc59402c55f8ca" title="8 bit unsigned integer.">u8</a>* file = (<a class="code" href="a00121.html#a92c50087ca0e64fa93fc59402c55f8ca" title="8 bit unsigned integer.">u8</a>*)World_txt;

 <span class="keywordtype">void</span> myGetStr(<span class="keywordtype">char</span>* buff, <span class="keywordtype">int</span> size)
{
    *buff = *file++;

    <span class="keywordflow">while</span>( (*buff != <span class="charliteral">&#39;\n&#39;</span>) &amp;&amp; (*buff != 0xD))
    {
        buff++;
        *buff = *file++;
    }
    
    buff[0] = <span class="charliteral">&#39;\n&#39;</span>; 
    buff[1] = 0;
    
}


<span class="keywordtype">void</span> readstr(<span class="keywordtype">char</span> *<span class="keywordtype">string</span>)
{
    <span class="keywordflow">do</span>
    {
        myGetStr(<span class="keywordtype">string</span>, 255);
    } <span class="keywordflow">while</span> ((<span class="keywordtype">string</span>[0] == <span class="charliteral">&#39;/&#39;</span>) || (<span class="keywordtype">string</span>[0] == <span class="charliteral">&#39;\n&#39;</span> ));
    <span class="keywordflow">return</span>;
}

<span class="keywordtype">void</span> SetupWorld()
{
    <span class="keywordtype">float</span> x, y, z; 
    <span class="keywordtype">float</span> u, v;
    <span class="keywordtype">int</span> numtriangles;
    <span class="keywordtype">char</span> oneline[255];

    readstr(oneline);
    sscanf(oneline, <span class="stringliteral">&quot;NUMPOLLIES %d\n&quot;</span>, &amp;numtriangles);

    sector1.triangle = (TRIANGLE*)malloc(numtriangles*<span class="keyword">sizeof</span>(TRIANGLE));
    sector1.numtriangles = numtriangles;
    
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> loop = 0; loop &lt; numtriangles; loop++)
    {
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> vert = 0; vert &lt; 3; vert++)
        {
            readstr(oneline);
            sscanf(oneline, <span class="stringliteral">&quot;%f %f %f %f %f&quot;</span>, &amp;x, &amp;y, &amp;z, &amp;u, &amp;v);
            sector1.triangle[loop].vertex[vert].x = <a name="a4"></a><a class="code" href="a00136.html#af41f2f141c93fe7c88e8d865fa5e315b" title="convert float to v16">floattov16</a>(x);
            sector1.triangle[loop].vertex[vert].y = <a class="code" href="a00136.html#af41f2f141c93fe7c88e8d865fa5e315b" title="convert float to v16">floattov16</a>(y);
            sector1.triangle[loop].vertex[vert].z = <a class="code" href="a00136.html#af41f2f141c93fe7c88e8d865fa5e315b" title="convert float to v16">floattov16</a>(z);
            sector1.triangle[loop].vertex[vert].u = <a name="a5"></a><a class="code" href="a00136.html#a1137e01ba734806a042e7abe59e9aca1" title="convert float to t16">floattot16</a>(u*128);
            sector1.triangle[loop].vertex[vert].v = <a class="code" href="a00136.html#a1137e01ba734806a042e7abe59e9aca1" title="convert float to t16">floattot16</a>(v*128);
        }
    }
    
    <span class="keywordflow">return</span>;
}
<span class="keywordtype">int</span> LoadGLTextures()                                    <span class="comment">// Load PCX files And Convert To Textures</span>
{
    <a name="_a6"></a><a class="code" href="a00080.html" title="A generic image structure.">sImage</a> pcx;                

    <span class="comment">//load our texture</span>
    <a name="a7"></a><a class="code" href="a00122.html#a5c59ba324a60280e1e91bdc9a58a5f3d" title="Loads an image structure with data from PCX formatted data.">loadPCX</a>((<a class="code" href="a00121.html#a92c50087ca0e64fa93fc59402c55f8ca" title="8 bit unsigned integer.">u8</a>*)Mud_pcx, &amp;pcx);
    
    <a name="a8"></a><a class="code" href="a00107.html#a0db57be415411cc38f75269ebbe6b18c" title="Converts an 8 bit image to 16 bit setting the alpha bit.">image8to16</a>(&amp;pcx);

    <a name="a9"></a><a class="code" href="a00136.html#aab7f277f7e9dd9683b8671ade84b3eda" title="Creates room for the specified number of textures.">glGenTextures</a>(1, &amp;texture[0]);
    <a name="a10"></a><a class="code" href="a00136.html#a3d8302fb3f30c1029b2e9cdd50f45a0a" title="glBindTexure sets the current named texture to the active texture. Target is ignored...">glBindTexture</a>(0, texture[0]);
    <a name="a11"></a><a class="code" href="a00136.html#a750259e65fe2e78340ded1119694dea7" title="Loads a 2D texture into texture memory and sets the currently bound texture ID to...">glTexImage2D</a>(0, 0, <a name="a12"></a><a class="code" href="a00136.html#a6861121fecdc3ba4592e3125c5ef1755a5429ba2be1e257cba360b31d8c14e3b3">GL_RGB</a>, <a name="a13"></a><a class="code" href="a00136.html#a9f0b28cb8d083a96b0156006ddfda933a6bdbbf9e2e8f8ff1e18e4c1cd0ce4b47">TEXTURE_SIZE_128</a> , <a class="code" href="a00136.html#a9f0b28cb8d083a96b0156006ddfda933a6bdbbf9e2e8f8ff1e18e4c1cd0ce4b47">TEXTURE_SIZE_128</a>, 0, <a name="a14"></a><a class="code" href="a00136.html#abeb94a88337262cc47317d39df438547aadf071cb4dfc859baf293e3f9381e30e">TEXGEN_TEXCOORD</a> | <a name="a15"></a><a class="code" href="a00136.html#abeb94a88337262cc47317d39df438547aba937855f8a8846f9244e0abf7b9a15f">GL_TEXTURE_WRAP_S</a> | <a name="a16"></a><a class="code" href="a00136.html#abeb94a88337262cc47317d39df438547ad1d5132d4d0fa3c1f8879d00697b689b">GL_TEXTURE_WRAP_T</a>, pcx.<a name="a17"></a><a class="code" href="a00080.html#a48ff0e282b646989a49b49a420e5b01b" title="A union of data pointers to the pixel data.">image</a>.<a name="a18"></a><a class="code" href="a00080.html#ad11da8bd06ec40d568f164c1144c48a7" title="pointer to 8 bit data.">data8</a>);

    <span class="keywordflow">return</span> TRUE;
}

<span class="keywordtype">int</span> main() {    
    
    <span class="comment">// Setup the Main screen for 3D </span>
    <a name="a19"></a><a class="code" href="a00135.html#ae3ea5c2e57cc40d6a88e21c4dcb742c8" title="the main 2D engine video mode">videoSetMode</a>(<a name="a20"></a><a class="code" href="a00135.html#a1e46218ee302fcc8c77e4ea0968ea149af75d73d6670d95a0cec81b8e648a0dca" title="3 2D backgrounds 1 3D background (Main engine only)">MODE_0_3D</a>);
    <a name="a21"></a><a class="code" href="a00135.html#a3e86d5c1a90d13eb82cab5d2ef6f52b2" title="Set bank A to the indicated mapping.">vramSetBankA</a>(<a name="a22"></a><a class="code" href="a00135.html#a348d2824280b1b94792407f4920e346aa94a8dcae8ac358090145f6f2aaa6b87b" title="maps vram a to 3d texture slot 0.">VRAM_A_TEXTURE</a>);                        <span class="comment">//NEW  must set up some memory for textures</span>
    
    <span class="comment">// initialize the geometry engine</span>
    <a name="a23"></a><a class="code" href="a00136.html#a29390b4085e778ee80b07b46efd4b2ca" title="Initializes the gl state machine (must be called once before using gl calls).">glInit</a>();
    
    <span class="comment">// enable textures</span>
    <a name="a24"></a><a class="code" href="a00136.html#acc179be4d402924ed239617a6aa422f2" title="Enables various gl states (blend, alpha test, etc..).">glEnable</a>(<a name="a25"></a><a class="code" href="a00136.html#a09e37320519ef82d47501185b7a76931a48a55102e3c54aa57bd8ea9ed997420e">GL_TEXTURE_2D</a>);
    
    <span class="comment">// enable antialiasing</span>
    <a class="code" href="a00136.html#acc179be4d402924ed239617a6aa422f2" title="Enables various gl states (blend, alpha test, etc..).">glEnable</a>(<a name="a26"></a><a class="code" href="a00136.html#a09e37320519ef82d47501185b7a76931aeb3eb07748974534a5a9ab69d190a3ad">GL_ANTIALIAS</a>);
    
    <span class="comment">// setup the rear plane</span>
    <a name="a27"></a><a class="code" href="a00136.html#a47af9a2279197ba4d95467cc0741f117" title="sets the color of the rear-plane(a.k.a Clear Color/Plane)">glClearColor</a>(0,0,0,31); <span class="comment">// BG must be opaque for AA to work</span>
    <a name="a28"></a><a class="code" href="a00136.html#a0316399378018c0409a78580cb1166a9" title="sets the polygon ID of the rear-plane(a.k.a. Clear/Color Plane), useful for antialiasing...">glClearPolyID</a>(63); <span class="comment">// BG must have a unique polygon ID for AA to work</span>
    <a name="a29"></a><a class="code" href="a00136.html#acf0b19102499eed4547a6cac367e51ef" title="reset the depth buffer to this value; generally set this to GL_MAX_DEPTH.  GBATEK...">glClearDepth</a>(0x7FFF);
    
    <span class="comment">// Set our viewport to be the same size as the screen</span>
    <a name="a30"></a><a class="code" href="a00136.html#a2dca9bf8f906cf5d97f7c11b6e7f3505" title="specify the viewport for following drawing, can be set several times per frame. ...">glViewport</a>(0,0,255,191);
    
    LoadGLTextures();
    SetupWorld();
    
    <a name="a31"></a><a class="code" href="a00136.html#a0735cc3f765138aeda473865ee1ecce6" title="change the current matrix mode  GBATEK http://nocash.emubase.de/gbatek.htm#ds3dmatrixloadmultiply...">glMatrixMode</a>(<a name="a32"></a><a class="code" href="a00136.html#a2d4b5d945cec30e7c025823f0447c2b4a9f052b4ec4987e02bae380daff5fa634">GL_PROJECTION</a>);
    <a name="a33"></a><a class="code" href="a00136.html#a3dbf4d6316eb7640e507572fe2612b70" title="loads an identity matrix to the current matrix, same as glIdentity(void)">glLoadIdentity</a>();
    <a name="a34"></a><a class="code" href="a00136.html#ab40589d7691759f889108bd71fbf10b1" title="Utility function which sets up the projection matrix (floating point version).">gluPerspective</a>(70, 256.0 / 192.0, 0.1, 100);
    
    <a name="a35"></a><a class="code" href="a00136.html#af036551b1827883eb67c63d54c196eb1" title="specify a color for following vertices">glColor3f</a>(1,1,1);
    
    <a name="a36"></a><a class="code" href="a00136.html#a953b2c59598171987e1dfc7f092c93eb" title="set a light up. Only parallel light sources are supported on the DS  GBATEK http://nocash...">glLight</a>(0, <a name="a37"></a><a class="code" href="a00135.html#abd4530c7880d389c9ea70e2e3b84aa9d" title="Macro to convert 5 bit r g b components into a single 15 bit RGB triplet.">RGB15</a>(31,31,31) , 0, <a name="a38"></a><a class="code" href="a00136.html#ab8dc8368494e1aabefb9ee1e93ceee3a" title="convert float to v10">floattov10</a>(-1.0), 0);
    
    <span class="comment">//need to set up some material properties since DS does not have them set by default</span>
    <a name="a39"></a><a class="code" href="a00136.html#afe2e87391012692d6ba2c845d6fdedfd" title="specify the material properties to be used in rendering lit polygons">glMaterialf</a>(<a name="a40"></a><a class="code" href="a00136.html#a8684b8eee6f248d164ce3e9bfbb51d55a7a74784f37e620c3bd16ac772884777d">GL_AMBIENT</a>, <a class="code" href="a00135.html#abd4530c7880d389c9ea70e2e3b84aa9d" title="Macro to convert 5 bit r g b components into a single 15 bit RGB triplet.">RGB15</a>(16,16,16));
    <a class="code" href="a00136.html#afe2e87391012692d6ba2c845d6fdedfd" title="specify the material properties to be used in rendering lit polygons">glMaterialf</a>(<a name="a41"></a><a class="code" href="a00136.html#a8684b8eee6f248d164ce3e9bfbb51d55afc7fe6d0852d2a320b5fac140b8d9d3d">GL_DIFFUSE</a>, <a class="code" href="a00135.html#abd4530c7880d389c9ea70e2e3b84aa9d" title="Macro to convert 5 bit r g b components into a single 15 bit RGB triplet.">RGB15</a>(16,16,16));
    <a class="code" href="a00136.html#afe2e87391012692d6ba2c845d6fdedfd" title="specify the material properties to be used in rendering lit polygons">glMaterialf</a>(<a name="a42"></a><a class="code" href="a00136.html#a8684b8eee6f248d164ce3e9bfbb51d55ab31c75774b5ae9c34b6741d823dd1668">GL_SPECULAR</a>, <a name="a43"></a><a class="code" href="a00121.html#a3a8ea58898cb58fc96013383d39f482c" title="returns a number with the nth bit set.">BIT</a>(15) | <a class="code" href="a00135.html#abd4530c7880d389c9ea70e2e3b84aa9d" title="Macro to convert 5 bit r g b components into a single 15 bit RGB triplet.">RGB15</a>(8,8,8));
    <a class="code" href="a00136.html#afe2e87391012692d6ba2c845d6fdedfd" title="specify the material properties to be used in rendering lit polygons">glMaterialf</a>(<a name="a44"></a><a class="code" href="a00136.html#a8684b8eee6f248d164ce3e9bfbb51d55a1ffd95e33d6885983d5c49fc7e564930">GL_EMISSION</a>, <a class="code" href="a00135.html#abd4530c7880d389c9ea70e2e3b84aa9d" title="Macro to convert 5 bit r g b components into a single 15 bit RGB triplet.">RGB15</a>(16,16,16));
    
    <span class="comment">//ds uses a table for shinyness..this generates a half-ass one</span>
    <a name="a45"></a><a class="code" href="a00136.html#ad999b0866a2200c1722ba4309f7d5d58" title="The DS uses a table for shininess..this generates a half-ass one.">glMaterialShinyness</a>();
    
    <span class="comment">//ds specific, several attributes can be set here   </span>
    <a name="a46"></a><a class="code" href="a00136.html#aad676c90bbd04d6cc1393d6c93f852c0" title="Set the parameters for polygons rendered on the current frame  GBATEK http://nocash...">glPolyFmt</a>(<a name="a47"></a><a class="code" href="a00136.html#a04ca9bdfcc44641cccf53aa338888b3c" title="used in glPolyFmt() to set the alpha level for the following polygons, set to 0 for...">POLY_ALPHA</a>(31) | <a name="a48"></a><a class="code" href="a00136.html#ac9ed764e909c0619b9abd34fb93f2b3cabd16e90881f219228faa391e2d396a07">POLY_CULL_NONE</a> | <a name="a49"></a><a class="code" href="a00136.html#ac9ed764e909c0619b9abd34fb93f2b3ca39227c084dd4643be0193b5f9279f545">POLY_FORMAT_LIGHT0</a>);
    
    <span class="comment">// Set the current matrix to be the model matrix</span>
    <a class="code" href="a00136.html#a0735cc3f765138aeda473865ee1ecce6" title="change the current matrix mode  GBATEK http://nocash.emubase.de/gbatek.htm#ds3dmatrixloadmultiply...">glMatrixMode</a>(<a name="a50"></a><a class="code" href="a00136.html#a2d4b5d945cec30e7c025823f0447c2b4ab61b6af2524c193dafa434f0d39d5fbb">GL_MODELVIEW</a>);
    
    <span class="keywordflow">while</span> (1) 
    {
        <span class="comment">//these little button functions are pretty handy</span>
        <a name="a51"></a><a class="code" href="a00109.html#af4e9294843965705093b39673ddbb2b4" title="Obtains the current keypad state. Call this function once per main loop in order...">scanKeys</a>();
                
    
        <span class="keywordflow">if</span> (<a name="a52"></a><a class="code" href="a00109.html#a33346c2b7c7a610aedff2feef9a5240e" title="Obtains the current keypad held state.">keysHeld</a>() &amp; <a name="a53"></a><a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072aa7b3a3d0503a46bec51c6e3da95747cc" title="Keypad A button.">KEY_A</a>)
        {
            lookupdown -= 1;
        }
        <span class="keywordflow">if</span> (<a class="code" href="a00109.html#a33346c2b7c7a610aedff2feef9a5240e" title="Obtains the current keypad held state.">keysHeld</a>() &amp; <a name="a54"></a><a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072a10072b5ee7aa1faf316434ecc9e2bb3a" title="Keypad B button.">KEY_B</a>)
        {
            lookupdown += 1;
        }
        
        <span class="keywordflow">if</span> (<a class="code" href="a00109.html#a33346c2b7c7a610aedff2feef9a5240e" title="Obtains the current keypad held state.">keysHeld</a>() &amp; <a name="a55"></a><a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072a612120b69c7dfd46086db7aaebdbcf65" title="Keypad LEFT button.">KEY_LEFT</a>)
        {
            heading += 64;  
            yrot = heading;
        }
        <span class="keywordflow">if</span> (<a class="code" href="a00109.html#a33346c2b7c7a610aedff2feef9a5240e" title="Obtains the current keypad held state.">keysHeld</a>() &amp; <a name="a56"></a><a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072a6504370d9c6391e1a9da6a1a529b089d" title="Keypad RIGHT button.">KEY_RIGHT</a>)
        {
            heading -= 64;
            yrot = heading;
        }
        <span class="keywordflow">if</span> (<a class="code" href="a00109.html#a33346c2b7c7a610aedff2feef9a5240e" title="Obtains the current keypad held state.">keysHeld</a>() &amp; <a name="a57"></a><a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072aa9cdac7967bf7d88fdb761138a2a3416" title="Keypad DOWN button.">KEY_DOWN</a>)
        {
            
            xpos += <a name="a58"></a><a class="code" href="a00134.html#a4488c5e9ab13094d971be867ea431846" title="fixed point sine">sinLerp</a>(heading)/20;
            zpos += <a name="a59"></a><a class="code" href="a00134.html#ab445a920fcc697d86f6f3035b0bcbf11" title="fixed point cosine">cosLerp</a>(heading)/20;

            walkbiasangle+= 640;
            
            walkbias = <a class="code" href="a00134.html#a4488c5e9ab13094d971be867ea431846" title="fixed point sine">sinLerp</a>(walkbiasangle)/20;
        }
        <span class="keywordflow">if</span> (<a class="code" href="a00109.html#a33346c2b7c7a610aedff2feef9a5240e" title="Obtains the current keypad held state.">keysHeld</a>() &amp; <a name="a60"></a><a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072a0848a442d907968b211b97bc2bd88acd" title="Keypad UP button.">KEY_UP</a>)
        {
            xpos -= <a class="code" href="a00134.html#a4488c5e9ab13094d971be867ea431846" title="fixed point sine">sinLerp</a>(heading)/20;
            zpos -= <a class="code" href="a00134.html#ab445a920fcc697d86f6f3035b0bcbf11" title="fixed point cosine">cosLerp</a>(heading)/20;

            walkbiasangle-= 640;
            
            walkbias = <a class="code" href="a00134.html#a4488c5e9ab13094d971be867ea431846" title="fixed point sine">sinLerp</a>(walkbiasangle)/20;
        }
        
        DrawGLScene();
        
        <span class="comment">// flush to screen  </span>
        <a name="a61"></a><a class="code" href="a00136.html#a11924dcc21af8cca165a1a553daf9235" title="Waits for a Vblank and swaps the buffers(like swiWaitForVBlank), but lets you specify...">glFlush</a>(0);
        
        <span class="comment">// wait for the screen to refresh</span>
        <a name="a62"></a><a class="code" href="a00111.html#a1e8361fc4819e3f39d187dc5c29c279a" title="Wait for vblank interrupt.">swiWaitForVBlank</a>();
    }
    
    <span class="keywordflow">return</span> 0;
}

<span class="keywordtype">int</span> DrawGLScene()                                           <span class="comment">// Here&#39;s Where We Do All The Drawing</span>
{
                                            <span class="comment">// Reset The View</span>

    <a class="code" href="a00136.html#a44a01f8e557971ded510967ffc18e7ff" title="vertex 4.12 fixed format">v16</a> x_m, y_m, z_m;
    <a class="code" href="a00136.html#ae5f96f1b78a6d76787a9f0a9fe9d3164" title="text coordinate 12.4 fixed point">t16</a> u_m, v_m;
    <a class="code" href="a00121.html#ab7903878916593daecbeb95b98115ab0" title="32 bit signed integer.">int32</a> xtrans = -xpos;
    <a class="code" href="a00121.html#ab7903878916593daecbeb95b98115ab0" title="32 bit signed integer.">int32</a> ztrans = -zpos;
    <a class="code" href="a00121.html#ab7903878916593daecbeb95b98115ab0" title="32 bit signed integer.">int32</a> ytrans = -walkbias-(1&lt;&lt;10);
    <span class="keywordtype">int</span> sceneroty = LUT_SIZE - yrot;
    
    <a class="code" href="a00136.html#a3dbf4d6316eb7640e507572fe2612b70" title="loads an identity matrix to the current matrix, same as glIdentity(void)">glLoadIdentity</a>();
    
    <span class="keywordtype">int</span> numtriangles;

    <a name="a63"></a><a class="code" href="a00136.html#aaf464cf354a4710e705787930ff96f16" title="Rotates the model view matrix by angle about the specified unit vector.">glRotatef32i</a>(lookupdown,(1&lt;&lt;12),0,0);
    <a class="code" href="a00136.html#aaf464cf354a4710e705787930ff96f16" title="Rotates the model view matrix by angle about the specified unit vector.">glRotatef32i</a>(sceneroty,0,(1&lt;&lt;12),0);
    
    <a name="a64"></a><a class="code" href="a00136.html#a7f6720ea6912f35076972a53ceaf474b" title="multiply the current matrix by a translation matrix  GBATEK http://nocash.emubase...">glTranslate3f32</a>(xtrans, ytrans, ztrans);
    <a class="code" href="a00136.html#a3d8302fb3f30c1029b2e9cdd50f45a0a" title="glBindTexure sets the current named texture to the active texture. Target is ignored...">glBindTexture</a>(<a class="code" href="a00136.html#a09e37320519ef82d47501185b7a76931a48a55102e3c54aa57bd8ea9ed997420e">GL_TEXTURE_2D</a>, texture[0]);
    
    numtriangles = sector1.numtriangles;
    
    
    <span class="comment">// Process Each Triangle</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> loop_m = 0; loop_m &lt; numtriangles; loop_m++)
    {
        <a name="a65"></a><a class="code" href="a00136.html#aa767ddea14a9219a8fc2a4a4645eea58" title="Starts a polygon group.">glBegin</a>(<a name="a66"></a><a class="code" href="a00136.html#a0e589918d10f56cda0c48e6f1dd389e9acc7d680eddc73989e6650e72ad0b6ac7">GL_TRIANGLES</a>);
            <a name="a67"></a><a class="code" href="a00136.html#a76cd940e714921daecd701cceb35f982" title="the normal to use for following vertices  GBATEK http://nocash.emubase.de/gbatek...">glNormal</a>(<a name="a68"></a><a class="code" href="a00136.html#aeee6c481e4a5b95020cde39735031950" title="Pack 3 v10 normals into a 32bit value.">NORMAL_PACK</a>( 0, 0, 1&lt;&lt;10));
            x_m = sector1.triangle[loop_m].vertex[0].x;
            y_m = sector1.triangle[loop_m].vertex[0].y;
            z_m = sector1.triangle[loop_m].vertex[0].z;
            u_m = sector1.triangle[loop_m].vertex[0].u;
            v_m = sector1.triangle[loop_m].vertex[0].v;
            <a name="a69"></a><a class="code" href="a00136.html#ac2fbc1b57094ea0192b60cc4a8a0dc36" title="Sets texture coordinates for following vertices  GBATEK http://nocash.emubase.de/gbatek...">glTexCoord2t16</a>(u_m,v_m); <a name="a70"></a><a class="code" href="a00136.html#adfd9e8e6c9d6c47786a0927f4b6b5e92" title="specifies a vertex">glVertex3v16</a>(x_m,y_m,z_m);
            
            x_m = sector1.triangle[loop_m].vertex[1].x;
            y_m = sector1.triangle[loop_m].vertex[1].y;
            z_m = sector1.triangle[loop_m].vertex[1].z;
            u_m = sector1.triangle[loop_m].vertex[1].u;
            v_m = sector1.triangle[loop_m].vertex[1].v;
            <a class="code" href="a00136.html#ac2fbc1b57094ea0192b60cc4a8a0dc36" title="Sets texture coordinates for following vertices  GBATEK http://nocash.emubase.de/gbatek...">glTexCoord2t16</a>(u_m,v_m); <a class="code" href="a00136.html#adfd9e8e6c9d6c47786a0927f4b6b5e92" title="specifies a vertex">glVertex3v16</a>(x_m,y_m,z_m);
            
            x_m = sector1.triangle[loop_m].vertex[2].x;
            y_m = sector1.triangle[loop_m].vertex[2].y;
            z_m = sector1.triangle[loop_m].vertex[2].z;
            u_m = sector1.triangle[loop_m].vertex[2].u;
            v_m = sector1.triangle[loop_m].vertex[2].v;
            <a class="code" href="a00136.html#ac2fbc1b57094ea0192b60cc4a8a0dc36" title="Sets texture coordinates for following vertices  GBATEK http://nocash.emubase.de/gbatek...">glTexCoord2t16</a>(u_m,v_m); <a class="code" href="a00136.html#adfd9e8e6c9d6c47786a0927f4b6b5e92" title="specifies a vertex">glVertex3v16</a>(x_m,y_m,z_m);
        <a name="a71"></a><a class="code" href="a00136.html#a9ba38906fa947236e63af2a29644775e" title="Ends a polygon group, this seems to be a dummy function that does absolutely nothing...">glEnd</a>();
    }
    <span class="keywordflow">return</span> TRUE;                                        <span class="comment">// Everything Went OK</span>

}
</pre></div> </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Mon Jul 26 10:36:03 2010 for libnds by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
