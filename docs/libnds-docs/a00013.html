<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>libnds: Graphics/Sprites/bitmap_sprites/source/main.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="docs.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Graphics/Sprites/bitmap_sprites/source/main.cpp</h1><div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="a00119.html" title="the master include file for nds applications.">nds.h</a>&gt;</span>

<span class="preprocessor">#include &lt;stdio.h&gt;</span>

<span class="comment">//a simple sprite structure </span>
<span class="comment">//it is generally preferred to separate your game object</span>
<span class="comment">//from OAM</span>
<span class="keyword">typedef</span> <span class="keyword">struct  </span>
{
   <a name="a0"></a><a class="code" href="a00121.html#ace9d960e74685e2cd84b36132dbbf8aa" title="16 bit unsigned integer.">u16</a>* gfx;
   <a class="code" href="a00129.html#a1b3e231e628b18808e49a2f94c96b1ea" title="Enumerates all sizes supported by the 2D engine.">SpriteSize</a> size;
   <a class="code" href="a00129.html#ada800fd4d653d0a31be9cce4e58c02b3" title="Color formats for sprite graphics.">SpriteColorFormat</a> format;
   <span class="keywordtype">int</span> rotationIndex;
   <span class="keywordtype">int</span> paletteAlpha;
   <span class="keywordtype">int</span> x;
   <span class="keywordtype">int</span> y;
}MySprite;

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {
    
   <span class="comment">//three sprites of differing color format</span>
   MySprite sprites[] = {
      {0, <a name="a1"></a><a class="code" href="a00129.html#a1b3e231e628b18808e49a2f94c96b1eaa0a53d992055af0a18946b18a2c40b7eb" title="32x32">SpriteSize_32x32</a>, <a name="a2"></a><a class="code" href="a00129.html#ada800fd4d653d0a31be9cce4e58c02b3a4e082cd13150f5f9e44b5efde6154229" title="16-bit sprites">SpriteColorFormat_Bmp</a>, 0, 15, 20, 15},
      {0, <a class="code" href="a00129.html#a1b3e231e628b18808e49a2f94c96b1eaa0a53d992055af0a18946b18a2c40b7eb" title="32x32">SpriteSize_32x32</a>, <a name="a3"></a><a class="code" href="a00129.html#ada800fd4d653d0a31be9cce4e58c02b3a75dcf8ab313bc18343d61a479d424d2c" title="256 colors per sprite">SpriteColorFormat_256Color</a>, -1, 0, 20, 80},
      {0, <a class="code" href="a00129.html#a1b3e231e628b18808e49a2f94c96b1eaa0a53d992055af0a18946b18a2c40b7eb" title="32x32">SpriteSize_32x32</a>, <a name="a4"></a><a class="code" href="a00129.html#ada800fd4d653d0a31be9cce4e58c02b3ad7ba51632b5d8c349b7373adf7fc1932" title="16 colors per sprite">SpriteColorFormat_16Color</a>, -1, 1, 20, 136}
   };

   <a name="a5"></a><a class="code" href="a00135.html#a9512ccda7405589119053638849cc56d" title="the sub 2D engine video mode">videoSetModeSub</a>(<a name="a6"></a><a class="code" href="a00135.html#a1e46218ee302fcc8c77e4ea0968ea149a9cdd63a31b19e5ff101d468d2af31fe6" title="4 2D backgrounds">MODE_0_2D</a>);

   <a name="a7"></a><a class="code" href="a00096.html#a2fb290779a23a2ccf4da6097d83d8323" title="Initialize the console to a default state for prototyping. This function sets the...">consoleDemoInit</a>();
   
   <span class="comment">//initialize the sub sprite engine with 1D mapping 128 byte boundary</span>
   <span class="comment">//and no external palette support</span>
   <a name="a8"></a><a class="code" href="a00129.html#a587040de52390a390d84d8c6d5eca646" title="Initializes the 2D sprite engine In order to mix tiled and bitmap sprites use SpriteMapping_Bmp_1D_1...">oamInit</a>(&amp;<a name="a9"></a>oamSub, <a name="a10"></a><a class="code" href="a00129.html#a4f529677a022eb1fe1d85c3ce65b2aceafaa3437c8fc938125264202b4b061acf" title="1D bitmap mapping 128 byte boundary between offset">SpriteMapping_Bmp_1D_128</a>, <span class="keyword">false</span>);

  
   <a name="a11"></a><a class="code" href="a00135.html#a694882dbdce2f11d74984ae51758bd63" title="Set bank D to the indicated mapping.">vramSetBankD</a>(<a name="a12"></a><a class="code" href="a00135.html#aec1c55c4879c6c563ac5a814a0bde674a10690b0d1b48341877aa487cf600c578" title="maps vram d to sub engine sprites slot 0.">VRAM_D_SUB_SPRITE</a>);
   
   <span class="comment">//allocate some space for the sprite graphics</span>
   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)
      sprites[i].gfx = <a name="a13"></a><a class="code" href="a00129.html#ace6894933f8ca396f71ed25141ada0d7" title="Allocates graphics memory for the supplied sprite attributes.">oamAllocateGfx</a>(&amp;oamSub, sprites[i].size, sprites[i].format);
   
   <span class="comment">//ugly positional printf</span>
   iprintf(<span class="stringliteral">&quot;\x1b[1;1HDirect Bitmap:&quot;</span>);
   iprintf(<span class="stringliteral">&quot;\x1b[9;1H256 color:&quot;</span>);
   iprintf(<span class="stringliteral">&quot;\x1b[16;1H16 color:&quot;</span>);
   
   <span class="comment">//fill bmp sprite with the color red</span>
   <a name="a14"></a><a class="code" href="a00101.html#aa4eb46d7ce51d26338207cf666806a83" title="fills the source with the supplied value using DMA channel 3">dmaFillHalfWords</a>(<a name="a15"></a><a class="code" href="a00135.html#a2c3f45f235d9ce20ca2713841c4744d7" title="Macro to convert 5 bit r g b components plus 1 bit alpha into a single 16 bit ARGB...">ARGB16</a>(1,31,0,0), sprites[0].gfx, 32*32*2);
   <span class="comment">//fill the 256 color sprite with index 1 (2 pixels at a time)</span>
   <a class="code" href="a00101.html#aa4eb46d7ce51d26338207cf666806a83" title="fills the source with the supplied value using DMA channel 3">dmaFillHalfWords</a>((1&lt;&lt;8)|1, sprites[1].gfx, 32*32);
   <span class="comment">//fill the 16 color sprite with index 1 (4 pixels at a time)</span>
   <a class="code" href="a00101.html#aa4eb46d7ce51d26338207cf666806a83" title="fills the source with the supplied value using DMA channel 3">dmaFillHalfWords</a>((1&lt;&lt;12)|(1&lt;&lt;8)|(1&lt;&lt;4)|1, sprites[2].gfx, 32*32 / 2);

   <span class="comment">//set index 1 to blue...this will be the 256 color sprite</span>
   <a name="a16"></a><a class="code" href="a00135.html#abf010915231579ba1bfa697cc73b8d84" title="sprite palette memory (sub engine)">SPRITE_PALETTE_SUB</a>[1] = <a name="a17"></a><a class="code" href="a00135.html#abd4530c7880d389c9ea70e2e3b84aa9d" title="Macro to convert 5 bit r g b components into a single 15 bit RGB triplet.">RGB15</a>(0,31,0);
   <span class="comment">//set index 17 to green...this will be the 16 color sprite</span>
   <a class="code" href="a00135.html#abf010915231579ba1bfa697cc73b8d84" title="sprite palette memory (sub engine)">SPRITE_PALETTE_SUB</a>[16 + 1] = <a class="code" href="a00135.html#abd4530c7880d389c9ea70e2e3b84aa9d" title="Macro to convert 5 bit r g b components into a single 15 bit RGB triplet.">RGB15</a>(0,0,31);

   <span class="keywordtype">int</span> angle = 0;

   <span class="keywordflow">while</span>(1) {
      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) {
         <a name="a18"></a><a class="code" href="a00129.html#a605548d2e83c72673de90d505e0f816e" title="sets an oam entry to the supplied values">oamSet</a>(
         &amp;oamSub, <span class="comment">//sub display </span>
         i,       <span class="comment">//oam entry to set</span>
         sprites[i].x, sprites[i].y, <span class="comment">//position </span>
         0, <span class="comment">//priority</span>
         sprites[i].paletteAlpha, <span class="comment">//palette for 16 color sprite or alpha for bmp sprite</span>
         sprites[i].size, 
         sprites[i].format, 
         sprites[i].gfx, 
         sprites[i].rotationIndex, 
         <span class="keyword">true</span>, <span class="comment">//double the size of rotated sprites</span>
         <span class="keyword">false</span>, <span class="comment">//don&#39;t hide the sprite</span>
         <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="comment">//vflip, hflip</span>
         <span class="keyword">false</span> <span class="comment">//apply mosaic</span>
         );
      }

      <a name="a19"></a><a class="code" href="a00129.html#a6e5bfc064a8423f1a252bda2d3bf0409" title="sets the specified rotation scale entry">oamRotateScale</a>(&amp;oamSub, 0, angle, (1 &lt;&lt; 8), (1&lt;&lt;8));

      angle += 64;

      <a name="a20"></a><a class="code" href="a00111.html#a1e8361fc4819e3f39d187dc5c29c279a" title="Wait for vblank interrupt.">swiWaitForVBlank</a>();

      <span class="comment">//send the updates to the hardware</span>
      <a name="a21"></a><a class="code" href="a00129.html#a4cd19004499e63efb1ed5e04d4039785" title="causes oam memory to be updated...must be called during vblank if using oam api">oamUpdate</a>(&amp;oamSub);
   }
   <span class="keywordflow">return</span> 0;
}


</pre></div> </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Mon Jul 26 10:36:03 2010 for libnds by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
