<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>libnds: dswifi/ap_search/source/template.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="docs.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>dswifi/ap_search/source/template.c</h1><div class="fragment"><pre class="fragment"><span class="comment">/*---------------------------------------------------------------------------------</span>
<span class="comment"></span>
<span class="comment">Simple wifi demo to locate and connect to an ap</span>
<span class="comment">-- dovoto</span>
<span class="comment"></span>
<span class="comment">---------------------------------------------------------------------------------*/</span>
<span class="preprocessor">#include &lt;<a class="code" href="a00119.html" title="the master include file for nds applications.">nds.h</a>&gt;</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;dswifi9.h&gt;</span>

<span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<span class="preprocessor">#include &lt;netinet/in.h&gt;</span>

<span class="preprocessor">#include &lt;sys/socket.h&gt;</span>
<span class="preprocessor">#include &lt;netdb.h&gt;</span>

<span class="comment">//---------------------------------------------------------------------------------</span>
Wifi_AccessPoint* findAP(<span class="keywordtype">void</span>){
    <span class="comment">//---------------------------------------------------------------------------------</span>

    <span class="keywordtype">int</span> selected = 0;  
    <span class="keywordtype">int</span> i;
    <span class="keywordtype">int</span> count = 0;

    <span class="keyword">static</span> Wifi_AccessPoint ap;

    Wifi_ScanMode(); <span class="comment">//this allows us to search for APs</span>

    <span class="keywordflow">while</span>(!(<a name="a0"></a><a class="code" href="a00109.html#a53b39b35dd9e47f94dac068da0cfa080" title="Obtains the current keypad pressed state.">keysDown</a>() &amp; <a name="a1"></a><a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072aa7b3a3d0503a46bec51c6e3da95747cc" title="Keypad A button.">KEY_A</a>))
    {
        <a name="a2"></a><a class="code" href="a00109.html#af4e9294843965705093b39673ddbb2b4" title="Obtains the current keypad state. Call this function once per main loop in order...">scanKeys</a>();

        <span class="comment">//find out how many APs there are in the area</span>
        count = Wifi_GetNumAP();

        <a name="a3"></a><a class="code" href="a00096.html#ac62c34a3fa2a6403c690dd80022b3e34" title="Clears the screan by iprintf(&amp;quot;\x1b[2J&amp;quot;);.">consoleClear</a>();

        iprintf(<span class="stringliteral">&quot;Number of APs found: %d\n&quot;</span>, count);

        <span class="comment">//display the APs to the user</span>
        <span class="keywordflow">for</span>(i = 0; i &lt; count; i++)
        {
            Wifi_AccessPoint ap;

            Wifi_GetAPData(i, &amp;ap);

            <span class="comment">// display the name of the AP</span>
            iprintf(<span class="stringliteral">&quot;%s %s Wep:%s Sig:%i\n&quot;</span>, 
                i == selected ? <span class="stringliteral">&quot;*&quot;</span> : <span class="stringliteral">&quot; &quot;</span>, 
                ap.ssid, 
                ap.flags &amp; WFLAG_APDATA_WEP ? <span class="stringliteral">&quot;Yes &quot;</span> : <span class="stringliteral">&quot;No &quot;</span>,
                ap.rssi * 100 / 0xD0);

        }

        <span class="comment">//move the selection asterick</span>
        <span class="keywordflow">if</span>(<a class="code" href="a00109.html#a53b39b35dd9e47f94dac068da0cfa080" title="Obtains the current keypad pressed state.">keysDown</a>() &amp; <a name="a4"></a><a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072a0848a442d907968b211b97bc2bd88acd" title="Keypad UP button.">KEY_UP</a>)
        {
            selected--;
            <span class="keywordflow">if</span>(selected &lt; 0)
            {
                selected = 0;
            }
        }

        <span class="keywordflow">if</span>(<a class="code" href="a00109.html#a53b39b35dd9e47f94dac068da0cfa080" title="Obtains the current keypad pressed state.">keysDown</a>()&amp;<a name="a5"></a><a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072aa9cdac7967bf7d88fdb761138a2a3416" title="Keypad DOWN button.">KEY_DOWN</a>)
        {
            selected++;
            <span class="keywordflow">if</span>(selected &gt;= count) 
            {
                selected = count - 1;
            }
        }

        <a name="a6"></a><a class="code" href="a00111.html#a1e8361fc4819e3f39d187dc5c29c279a" title="Wait for vblank interrupt.">swiWaitForVBlank</a>();
    }

    <span class="comment">//user has made a choice so grab the ap and return it</span>
    Wifi_GetAPData(selected, &amp;ap);

    <span class="keywordflow">return</span> &amp;ap;
}

<span class="comment">//---------------------------------------------------------------------------------</span>
<span class="keywordtype">void</span> keyPressed(<span class="keywordtype">int</span> c){
<span class="comment">//---------------------------------------------------------------------------------</span>
    <span class="keywordflow">if</span>(c &gt; 0) iprintf(<span class="stringliteral">&quot;%c&quot;</span>,c);
}

<span class="comment">//---------------------------------------------------------------------------------</span>
<span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {
<span class="comment">//---------------------------------------------------------------------------------</span>
    Wifi_InitDefault(<span class="keyword">false</span>);
    
    <a name="a7"></a><a class="code" href="a00096.html#a2fb290779a23a2ccf4da6097d83d8323" title="Initialize the console to a default state for prototyping. This function sets the...">consoleDemoInit</a>(); 

    <span class="comment">//Keyboard* kb = keyboardDemoInit();</span>
    <span class="comment">//kb-&gt;OnKeyPressed = keyPressed;</span>

    <span class="keywordflow">while</span>(1);

    {
        <span class="keywordtype">int</span> status = ASSOCSTATUS_DISCONNECTED;

        <a class="code" href="a00096.html#ac62c34a3fa2a6403c690dd80022b3e34" title="Clears the screan by iprintf(&amp;quot;\x1b[2J&amp;quot;);.">consoleClear</a>();

        Wifi_AccessPoint* ap = findAP();

        iprintf(<span class="stringliteral">&quot;Connecting to %s\n&quot;</span>, ap-&gt;ssid);

        <span class="comment">//this tells the wifi lib to use dhcp for everything</span>
        Wifi_SetIP(0,0,0,0,0);  

        Wifi_ConnectAP(ap, WEPMODE_NONE, 0, 0);

        <span class="keywordflow">while</span>(status != ASSOCSTATUS_ASSOCIATED &amp;&amp; status != ASSOCSTATUS_CANNOTCONNECT) {
            <span class="keywordtype">int</span> oldStatus = status;

            status = Wifi_AssocStatus();

            iprintf(<span class="stringliteral">&quot;%s&quot;</span>, oldStatus != status ? ASSOCSTATUS_STRINGS[status] : <span class="stringliteral">&quot;.&quot;</span>);

            <a class="code" href="a00109.html#af4e9294843965705093b39673ddbb2b4" title="Obtains the current keypad state. Call this function once per main loop in order...">scanKeys</a>();

            <span class="keywordflow">if</span>(<a class="code" href="a00109.html#a53b39b35dd9e47f94dac068da0cfa080" title="Obtains the current keypad pressed state.">keysDown</a>() &amp; <a name="a8"></a><a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072a10072b5ee7aa1faf316434ecc9e2bb3a" title="Keypad B button.">KEY_B</a>) <span class="keywordflow">break</span>;
            
            <a class="code" href="a00111.html#a1e8361fc4819e3f39d187dc5c29c279a" title="Wait for vblank interrupt.">swiWaitForVBlank</a>();
        }
        <a class="code" href="a00096.html#ac62c34a3fa2a6403c690dd80022b3e34" title="Clears the screan by iprintf(&amp;quot;\x1b[2J&amp;quot;);.">consoleClear</a>();
        <a name="a9"></a><a class="code" href="a00096.html#a4a65cfe4467b2059c6b70e15d861b563" title="Sets the print window.">consoleSetWindow</a>(NULL, 0,0,32,10);

        <span class="keywordtype">char</span> url[256];

        <span class="keywordflow">if</span>(status == ASSOCSTATUS_ASSOCIATED) {
            <span class="keywordflow">while</span>(1) {
                <a name="a10"></a><a class="code" href="a00121.html#afaa62991928fb9fb18ff0db62a040aba" title="32 bit unsigned integer.">u32</a> ip = Wifi_GetIP();

                iprintf(<span class="stringliteral">&quot;ip: [%i.%i.%i.%i]&quot;</span>, (ip ) &amp; 0xFF, (ip &gt;&gt; 8) &amp; 0xFF, (ip &gt;&gt; 16) &amp; 0xFF, (ip &gt;&gt; 24) &amp; 0xFF);

                scanf(<span class="stringliteral">&quot;%s&quot;</span>, url);

                <span class="keyword">struct </span>hostent *host = gethostbyname(url);

                <span class="keywordflow">if</span>(host)
                    iprintf(<span class="stringliteral">&quot;IP (%s) : %s\n&quot;</span>,  url, inet_ntoa(*(<span class="keyword">struct</span> in_addr *)host-&gt;h_addr_list[0]));
                <span class="keywordflow">else</span>
                    iprintf(<span class="stringliteral">&quot;Could not resolve\n&quot;</span>);

                <a class="code" href="a00109.html#af4e9294843965705093b39673ddbb2b4" title="Obtains the current keypad state. Call this function once per main loop in order...">scanKeys</a>();

                <span class="keywordflow">if</span>(<a class="code" href="a00109.html#a53b39b35dd9e47f94dac068da0cfa080" title="Obtains the current keypad pressed state.">keysDown</a>() &amp; <a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072a10072b5ee7aa1faf316434ecc9e2bb3a" title="Keypad B button.">KEY_B</a>) <span class="keywordflow">break</span>;

                <a class="code" href="a00111.html#a1e8361fc4819e3f39d187dc5c29c279a" title="Wait for vblank interrupt.">swiWaitForVBlank</a>();
            }
        }
    }
    <span class="keywordflow">return</span> 0;
}
</pre></div> </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Mon Jul 26 10:36:03 2010 for libnds by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
