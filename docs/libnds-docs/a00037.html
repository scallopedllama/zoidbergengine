<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>libnds: time/RealTimeClock/source/main.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="docs.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>time/RealTimeClock/source/main.c</h1><div class="fragment"><pre class="fragment">
<span class="comment">/*-----------------</span>
<span class="comment"></span>
<span class="comment">Very simple RTC example with a cheesy watch face</span>
<span class="comment"></span>
<span class="comment">\*----------------*/</span>

<span class="preprocessor">#include &lt;<a class="code" href="a00119.html" title="the master include file for nds applications.">nds.h</a>&gt;</span>

<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;time.h&gt;</span>

<span class="keyword">const</span> <span class="keywordtype">char</span>* months[12] = {<span class="stringliteral">&quot;January&quot;</span>, <span class="stringliteral">&quot;February&quot;</span>, <span class="stringliteral">&quot;March&quot;</span>, <span class="stringliteral">&quot;April&quot;</span>, <span class="stringliteral">&quot;May&quot;</span>, <span class="stringliteral">&quot;June&quot;</span>, <span class="stringliteral">&quot;July&quot;</span>, <span class="stringliteral">&quot;August&quot;</span>, <span class="stringliteral">&quot;September&quot;</span>, <span class="stringliteral">&quot;October&quot;</span>, <span class="stringliteral">&quot;November&quot;</span>, <span class="stringliteral">&quot;December&quot;</span>};

<span class="keyword">const</span> <span class="keywordtype">char</span>* weekDays[7] = {<span class="stringliteral">&quot;Sunday&quot;</span>, <span class="stringliteral">&quot;Monday&quot;</span>, <span class="stringliteral">&quot;Tuesday&quot;</span>, <span class="stringliteral">&quot;Wednesday&quot;</span>, <span class="stringliteral">&quot;Thursday&quot;</span>, <span class="stringliteral">&quot;Friday&quot;</span>, <span class="stringliteral">&quot;Saturday&quot;</span>};

<span class="keyword">const</span> <a name="a0"></a><a class="code" href="a00121.html#ace9d960e74685e2cd84b36132dbbf8aa" title="16 bit unsigned integer.">u16</a> daysAtStartOfMonthLUT[12] =
{
    0   %7, <span class="comment">//januari       31</span>
    31  %7, <span class="comment">//februari      28+1(leap year)</span>
    59  %7, <span class="comment">//maart         31</span>
    90  %7, <span class="comment">//april         30</span>
    120 %7, <span class="comment">//mei           31</span>
    151 %7, <span class="comment">//juni          30</span>
    181 %7, <span class="comment">//juli          31</span>
    212 %7, <span class="comment">//augustus      31</span>
    243 %7, <span class="comment">//september     30</span>
    273 %7, <span class="comment">//oktober       31</span>
    304 %7, <span class="comment">//november      30</span>
    334 %7  <span class="comment">//december      31</span>
};

<span class="preprocessor">#define isLeapYear(year) (((year)%4) == 0)</span>
<span class="preprocessor"></span>
uint getDayOfWeek(uint day, uint month, uint year)
{
    <span class="comment">//http://en.wikipedia.org/wiki/Calculating_the_day_of_the_week</span>

    day += 2*(3-((year/100)%4));
    year %= 100;
    day += year + (year/4);
    day += daysAtStartOfMonthLUT[month] - (isLeapYear(year) &amp;&amp; (month &lt;= 1));
    <span class="keywordflow">return</span> day % 7;
}



<span class="keywordtype">void</span> init3D();
<span class="keywordtype">void</span> update3D(<span class="keywordtype">int</span> hours, <span class="keywordtype">int</span> seconds, <span class="keywordtype">int</span> minutes);


<span class="keywordtype">int</span> main()
{
    <span class="keywordtype">int</span> hours, seconds, minutes, day, month, year;

    <a name="a1"></a><a class="code" href="a00096.html#a2fb290779a23a2ccf4da6097d83d8323" title="Initialize the console to a default state for prototyping. This function sets the...">consoleDemoInit</a>();

    init3D();

    <span class="keywordflow">while</span>(<span class="keyword">true</span>)
    {
        time_t unixTime = time(NULL);
        <span class="keyword">struct </span>tm* timeStruct = gmtime((<span class="keyword">const</span> time_t *)&amp;unixTime);

        hours = timeStruct-&gt;tm_hour;
        minutes = timeStruct-&gt;tm_min;
        seconds = timeStruct-&gt;tm_sec;
        day = timeStruct-&gt;tm_mday;
        month = timeStruct-&gt;tm_mon;
        year = timeStruct-&gt;tm_year +1900;

        printf(<span class="stringliteral">&quot;\x1b[2J%02i:%02i:%02i&quot;</span>, hours, minutes, seconds);
        printf(<span class="stringliteral">&quot;\n%s %s %i %i&quot;</span>, weekDays[getDayOfWeek(day, month, year)], months[month], day, year);


        update3D(hours, seconds, minutes);

        <a name="a2"></a><a class="code" href="a00111.html#a1e8361fc4819e3f39d187dc5c29c279a" title="Wait for vblank interrupt.">swiWaitForVBlank</a>();
    }

    <span class="keywordflow">return</span> 0;
}





<span class="comment">//draw a watch hands</span>
<span class="keywordtype">void</span> DrawQuad(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">float</span> width, <span class="keywordtype">float</span> height)
{

    <a name="a3"></a><a class="code" href="a00136.html#aa767ddea14a9219a8fc2a4a4645eea58" title="Starts a polygon group.">glBegin</a>(<a name="a4"></a><a class="code" href="a00136.html#a0e589918d10f56cda0c48e6f1dd389e9aab4577ef231a4142312b13d957352ed3">GL_QUADS</a>);
    <a name="a5"></a><a class="code" href="a00136.html#a9237e35f838d025ed42e566ad237b6da" title="specifies a vertex location">glVertex3f</a>(x - width / 2, y, 0);
    <a class="code" href="a00136.html#a9237e35f838d025ed42e566ad237b6da" title="specifies a vertex location">glVertex3f</a>(x + width / 2, y, 0);
    <a class="code" href="a00136.html#a9237e35f838d025ed42e566ad237b6da" title="specifies a vertex location">glVertex3f</a>(x  + width / 2, y  + height, 0);
    <a class="code" href="a00136.html#a9237e35f838d025ed42e566ad237b6da" title="specifies a vertex location">glVertex3f</a>(x - width / 2, y  + height, 0);
    <a name="a6"></a><a class="code" href="a00136.html#a9ba38906fa947236e63af2a29644775e" title="Ends a polygon group, this seems to be a dummy function that does absolutely nothing...">glEnd</a>();
}

<span class="keywordtype">void</span> init3D()
{
    <span class="comment">//put 3D on top</span>
    <a name="a7"></a><a class="code" href="a00130.html#a1ac0452f290abccc30614c5cbb0f56d0" title="Forces the main core to display on the top.">lcdMainOnTop</a>();

    <span class="comment">// Setup the Main screen for 3D</span>
    <a name="a8"></a><a class="code" href="a00135.html#ae3ea5c2e57cc40d6a88e21c4dcb742c8" title="the main 2D engine video mode">videoSetMode</a>(<a name="a9"></a><a class="code" href="a00135.html#a1e46218ee302fcc8c77e4ea0968ea149af75d73d6670d95a0cec81b8e648a0dca" title="3 2D backgrounds 1 3D background (Main engine only)">MODE_0_3D</a>);

    <span class="comment">// Reset the screen and setup the view</span>
    <a name="a10"></a><a class="code" href="a00136.html#a29390b4085e778ee80b07b46efd4b2ca" title="Initializes the gl state machine (must be called once before using gl calls).">glInit</a>();

    <span class="comment">// Set our viewport to be the same size as the screen</span>
    <a name="a11"></a><a class="code" href="a00136.html#a2dca9bf8f906cf5d97f7c11b6e7f3505" title="specify the viewport for following drawing, can be set several times per frame. ...">glViewport</a>(0,0,255,191);

    <span class="comment">// Specify the Clear Color and Depth</span>
    <a name="a12"></a><a class="code" href="a00136.html#a47af9a2279197ba4d95467cc0741f117" title="sets the color of the rear-plane(a.k.a Clear Color/Plane)">glClearColor</a>(0,0,0,31);
    <a name="a13"></a><a class="code" href="a00136.html#acf0b19102499eed4547a6cac367e51ef" title="reset the depth buffer to this value; generally set this to GL_MAX_DEPTH.  GBATEK...">glClearDepth</a>(0x7FFF);

    <span class="comment">//ds specific, several attributes can be set here</span>
    <a name="a14"></a><a class="code" href="a00136.html#aad676c90bbd04d6cc1393d6c93f852c0" title="Set the parameters for polygons rendered on the current frame  GBATEK http://nocash...">glPolyFmt</a>(<a name="a15"></a><a class="code" href="a00136.html#a04ca9bdfcc44641cccf53aa338888b3c" title="used in glPolyFmt() to set the alpha level for the following polygons, set to 0 for...">POLY_ALPHA</a>(31) | <a name="a16"></a><a class="code" href="a00136.html#ac9ed764e909c0619b9abd34fb93f2b3cabd16e90881f219228faa391e2d396a07">POLY_CULL_NONE</a>);

    <span class="comment">// Set the current matrix to be the model matrix</span>
    <a name="a17"></a><a class="code" href="a00136.html#a0735cc3f765138aeda473865ee1ecce6" title="change the current matrix mode  GBATEK http://nocash.emubase.de/gbatek.htm#ds3dmatrixloadmultiply...">glMatrixMode</a>(<a name="a18"></a><a class="code" href="a00136.html#a2d4b5d945cec30e7c025823f0447c2b4ab61b6af2524c193dafa434f0d39d5fbb">GL_MODELVIEW</a>);
    <a name="a19"></a><a class="code" href="a00136.html#a3dbf4d6316eb7640e507572fe2612b70" title="loads an identity matrix to the current matrix, same as glIdentity(void)">glLoadIdentity</a>();

    <a class="code" href="a00136.html#a0735cc3f765138aeda473865ee1ecce6" title="change the current matrix mode  GBATEK http://nocash.emubase.de/gbatek.htm#ds3dmatrixloadmultiply...">glMatrixMode</a>(<a name="a20"></a><a class="code" href="a00136.html#a2d4b5d945cec30e7c025823f0447c2b4a9f052b4ec4987e02bae380daff5fa634">GL_PROJECTION</a>);
    <a class="code" href="a00136.html#a3dbf4d6316eb7640e507572fe2612b70" title="loads an identity matrix to the current matrix, same as glIdentity(void)">glLoadIdentity</a>();
    <a name="a21"></a><a class="code" href="a00136.html#ab40589d7691759f889108bd71fbf10b1" title="Utility function which sets up the projection matrix (floating point version).">gluPerspective</a>(70, 256.0 / 192.0, 0.1, 100);
    <a name="a22"></a><a class="code" href="a00136.html#ae379e6b9371e46316838a1940478745f" title="Places the camera at the specified location and orientation (floating point version)...">gluLookAt</a>(  0.0, 0.0, 3.0,      <span class="comment">//camera possition</span>
                0.0, 0.0, 0.0,      <span class="comment">//look at</span>
                0.0, 1.0, 0.0);     <span class="comment">//up</span>
}


<span class="keywordtype">void</span> update3D(<span class="keywordtype">int</span> hours, <span class="keywordtype">int</span> seconds, <span class="keywordtype">int</span> minutes)
{
    <span class="comment">//Push our original Matrix onto the stack (save state)</span>
    <a name="a23"></a><a class="code" href="a00136.html#adc07d63d8e4fdf97bed3e6c5199b9ced" title="Pushes the current matrix onto the stack  GBATEK http://nocash.emubase.de/gbatek...">glPushMatrix</a>();

    <span class="comment">//draw second hand</span>
    <a name="a24"></a><a class="code" href="a00136.html#af036551b1827883eb67c63d54c196eb1" title="specify a color for following vertices">glColor3f</a>(0,0,1);
    <a name="a25"></a><a class="code" href="a00136.html#afbaf2fee09819be6bb82296ffba2487f" title="Rotates the current modelview matrix by angle degrees about the z axis.">glRotateZ</a>(-seconds * 360 / 60);
    <a name="a26"></a><a class="code" href="a00136.html#a15ee4820b85ebc3888ae2bdde39ed58e" title="multiply the current matrix by a translation matrix  GBATEK http://nocash.emubase...">glTranslatef</a>(0,1.9,0);
    DrawQuad(0,0,.2,.2);

    <span class="comment">// Pop our Matrix from the stack (restore state)</span>
    <a name="a27"></a><a class="code" href="a00136.html#accbd33aa10c42871ee362357f7d974c8" title="Pops num matrices off the stack  GBATEK http://nocash.emubase.de/gbatek.htm#ds3dmatrixstack...">glPopMatrix</a>(1);

    <span class="comment">//Push our original Matrix onto the stack (save state)</span>
    <a class="code" href="a00136.html#adc07d63d8e4fdf97bed3e6c5199b9ced" title="Pushes the current matrix onto the stack  GBATEK http://nocash.emubase.de/gbatek...">glPushMatrix</a>();

    <span class="comment">//draw minute hand</span>
    <a class="code" href="a00136.html#af036551b1827883eb67c63d54c196eb1" title="specify a color for following vertices">glColor3f</a>(0,1,0);
    <a class="code" href="a00136.html#afbaf2fee09819be6bb82296ffba2487f" title="Rotates the current modelview matrix by angle degrees about the z axis.">glRotateZ</a>(-minutes * 360 / 60);
    DrawQuad(0,0,.2,2);

    <span class="comment">// Pop our Matrix from the stack (restore state)</span>
    <a class="code" href="a00136.html#accbd33aa10c42871ee362357f7d974c8" title="Pops num matrices off the stack  GBATEK http://nocash.emubase.de/gbatek.htm#ds3dmatrixstack...">glPopMatrix</a>(1);

    <span class="comment">//Push our original Matrix onto the stack (save state)</span>
    <a class="code" href="a00136.html#adc07d63d8e4fdf97bed3e6c5199b9ced" title="Pushes the current matrix onto the stack  GBATEK http://nocash.emubase.de/gbatek...">glPushMatrix</a>();

    <span class="comment">//draw hourhand</span>
    <a class="code" href="a00136.html#af036551b1827883eb67c63d54c196eb1" title="specify a color for following vertices">glColor3f</a>(1,0,0);
    <a class="code" href="a00136.html#afbaf2fee09819be6bb82296ffba2487f" title="Rotates the current modelview matrix by angle degrees about the z axis.">glRotateZ</a>(-hours * 360 / 12);
    DrawQuad(0,0,.3,1.8);

    <span class="comment">// Pop our Matrix from the stack (restore state)</span>
    <a class="code" href="a00136.html#accbd33aa10c42871ee362357f7d974c8" title="Pops num matrices off the stack  GBATEK http://nocash.emubase.de/gbatek.htm#ds3dmatrixstack...">glPopMatrix</a>(1);

    <span class="comment">// flush to screen</span>
    <a name="a28"></a><a class="code" href="a00136.html#a11924dcc21af8cca165a1a553daf9235" title="Waits for a Vblank and swaps the buffers(like swiWaitForVBlank), but lets you specify...">glFlush</a>(0);
}


</pre></div> </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Mon Jul 26 10:36:04 2010 for libnds by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
