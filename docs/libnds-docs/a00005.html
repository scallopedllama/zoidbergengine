<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>libnds: Graphics/Backgrounds/all_in_one/source/scrolling.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="docs.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Graphics/Backgrounds/all_in_one/source/scrolling.cpp</h1><div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="a00119.html" title="the master include file for nds applications.">nds.h</a>&gt;</span>

<span class="preprocessor">#include &lt;RotBackgrounds.h&gt;</span>
<span class="preprocessor">#include &lt;TextBackgrounds.h&gt;</span>
<span class="preprocessor">#include &lt;Multilayer.h&gt;</span>

<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>

<span class="comment">//reusable scroll function to allow the user to explore </span>
<span class="comment">//the maps somewhat</span>
<span class="keywordtype">void</span> scroll(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height)
{
   <span class="keywordtype">int</span> keys = 0;
   <span class="keywordtype">int</span> sx = 0;
   <span class="keywordtype">int</span> sy = 0;

   <span class="keywordflow">while</span>(!(keys &amp; <a name="a0"></a><a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072a10072b5ee7aa1faf316434ecc9e2bb3a" title="Keypad B button.">KEY_B</a>))
   {
      <a name="a1"></a><a class="code" href="a00109.html#af4e9294843965705093b39673ddbb2b4" title="Obtains the current keypad state. Call this function once per main loop in order...">scanKeys</a>();

      keys = <a name="a2"></a><a class="code" href="a00109.html#a33346c2b7c7a610aedff2feef9a5240e" title="Obtains the current keypad held state.">keysHeld</a>();

      <span class="keywordflow">if</span>(keys &amp; <a name="a3"></a><a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072a0848a442d907968b211b97bc2bd88acd" title="Keypad UP button.">KEY_UP</a>) sy--;
      <span class="keywordflow">if</span>(keys &amp; <a name="a4"></a><a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072aa9cdac7967bf7d88fdb761138a2a3416" title="Keypad DOWN button.">KEY_DOWN</a>) sy++;
      <span class="keywordflow">if</span>(keys &amp; <a name="a5"></a><a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072a612120b69c7dfd46086db7aaebdbcf65" title="Keypad LEFT button.">KEY_LEFT</a>) sx--;
      <span class="keywordflow">if</span>(keys &amp; <a name="a6"></a><a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072a6504370d9c6391e1a9da6a1a529b089d" title="Keypad RIGHT button.">KEY_RIGHT</a>) sx++;

      <span class="keywordflow">if</span>(sx &lt; 0) sx = 0;
      <span class="keywordflow">if</span>(sx &gt;= width - 256) sx = width - 1 - 256;
      <span class="keywordflow">if</span>(sy &lt; 0) sy = 0;
      <span class="keywordflow">if</span>(sy &gt;= height - 192) sy = height - 1 - 192;

      <a name="a7"></a><a class="code" href="a00111.html#a1e8361fc4819e3f39d187dc5c29c279a" title="Wait for vblank interrupt.">swiWaitForVBlank</a>();

      <a name="a8"></a><a class="code" href="a00140.html#ga70ace440e43e447bc51e2802bac2cb3e" title="Sets the scroll hardware to the specified location.">bgSetScroll</a>(<span class="keywordtype">id</span>, sx, sy);

      <a name="a9"></a><a class="code" href="a00140.html#ga10a22ba4815acf3e345003c1d110f872" title="Must be called once per frame to update scroll/scale/and rotation of backgrounds...">bgUpdate</a>();

      <a name="a10"></a><a class="code" href="a00096.html#ac62c34a3fa2a6403c690dd80022b3e34" title="Clears the screan by iprintf(&amp;quot;\x1b[2J&amp;quot;);.">consoleClear</a>();
      iprintf(<span class="stringliteral">&quot;Scroll x: %d Scroll y: %d\n&quot;</span>, sx, sy);
      iprintf(<span class="stringliteral">&quot;Press &#39;B&#39; to exit&quot;</span>);
   }
}


<span class="keywordtype">void</span> scrollText(<span class="keywordtype">void</span>)
{
   <span class="keywordtype">int</span> keys = 0;
   <span class="keywordtype">int</span> sx = 0;
   <span class="keywordtype">int</span> sy = 0;
   <span class="keywordtype">int</span> width = 256;
   <span class="keywordtype">int</span> height = 512;

   <span class="comment">//set up a simple text background</span>
   <a name="a11"></a><a class="code" href="a00135.html#ae3ea5c2e57cc40d6a88e21c4dcb742c8" title="the main 2D engine video mode">videoSetMode</a>(<a name="a12"></a><a class="code" href="a00135.html#a1e46218ee302fcc8c77e4ea0968ea149a9cdd63a31b19e5ff101d468d2af31fe6" title="4 2D backgrounds">MODE_0_2D</a>);
   <a name="a13"></a><a class="code" href="a00135.html#a3e86d5c1a90d13eb82cab5d2ef6f52b2" title="Set bank A to the indicated mapping.">vramSetBankA</a>(<a name="a14"></a><a class="code" href="a00135.html#a348d2824280b1b94792407f4920e346aa63f5b895f2a5f54c19babbe2b1a9fe63" title="maps vram a to main engine background slot 0.">VRAM_A_MAIN_BG</a>);

   <span class="keywordtype">int</span> bg = <a name="a15"></a><a class="code" href="a00140.html#gaf2ba2b415bf8e02ccc0b30c55f878496" title="Initializes a background on the main display Sets up background control register...">bgInit</a>(0, <a name="a16"></a><a class="code" href="a00140.html#gga421d43ca799fd0c471335846da06cae1a6c229556bb8ab864190671ad29b4f12f" title="8bpp Tiled background with 16 bit tile indexes and no allowed rotation or scaling...">BgType_Text8bpp</a>, <a name="a17"></a><a class="code" href="a00140.html#gga6bd2253ebf93a399fa956a2a7b8b6b3ba58185efd0b7ffca03201d60e479c3f72">BgSize_T_256x512</a>, 0,1);

   <a name="a18"></a><a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(TextBackgroundsTiles, <a name="a19"></a><a class="code" href="a00140.html#ga8056a3c13f45f94003e90bd6a86f3a19" title="Gets a pointer to the background graphics.">bgGetGfxPtr</a>(bg), <span class="keyword">sizeof</span>(TextBackgroundsTiles));
   <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(Layer256x512Map, <a name="a20"></a><a class="code" href="a00140.html#ga375acd93ac465dcc52650cdafb9e74ad" title="Gets a pointer to the background map.">bgGetMapPtr</a>(bg),  Layer256x512MapLen);
   <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(TextBackgroundsPal, <a name="a21"></a><a class="code" href="a00135.html#affd17d691136b146eea14f7f9385bbf1" title="background palette memory">BG_PALETTE</a>, <span class="keyword">sizeof</span>(TextBackgroundsPal));

   <span class="keywordflow">while</span>(!(keys &amp; <a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072a10072b5ee7aa1faf316434ecc9e2bb3a" title="Keypad B button.">KEY_B</a>))
   {
      <a class="code" href="a00109.html#af4e9294843965705093b39673ddbb2b4" title="Obtains the current keypad state. Call this function once per main loop in order...">scanKeys</a>();

      keys = <a class="code" href="a00109.html#a33346c2b7c7a610aedff2feef9a5240e" title="Obtains the current keypad held state.">keysHeld</a>();

      <span class="keywordflow">if</span>(keys &amp; <a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072a0848a442d907968b211b97bc2bd88acd" title="Keypad UP button.">KEY_UP</a>) sy--;
      <span class="keywordflow">if</span>(keys &amp; <a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072aa9cdac7967bf7d88fdb761138a2a3416" title="Keypad DOWN button.">KEY_DOWN</a>) sy++;
      <span class="keywordflow">if</span>(keys &amp; <a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072a612120b69c7dfd46086db7aaebdbcf65" title="Keypad LEFT button.">KEY_LEFT</a>) sx--;
      <span class="keywordflow">if</span>(keys &amp; <a class="code" href="a00110.html#aa27cad8fa018a58930b6622783a83072a6504370d9c6391e1a9da6a1a529b089d" title="Keypad RIGHT button.">KEY_RIGHT</a>) sx++;

      <span class="comment">//clamp the scroll value to the map width and height</span>
      <span class="keywordflow">if</span>(sx &lt; 0) sx = 0;
      <span class="keywordflow">if</span>(sx &gt;= width - 256) sx = width - 1 - 256;
      <span class="keywordflow">if</span>(sy &lt; 0) sy = 0;
      <span class="keywordflow">if</span>(sy &gt;= height - 192) sy = height - 1 - 192;

      <a class="code" href="a00111.html#a1e8361fc4819e3f39d187dc5c29c279a" title="Wait for vblank interrupt.">swiWaitForVBlank</a>();

      <span class="comment">//normally would call bgSetScroll(id, sx, sy) here</span>
      <span class="comment">//but to demonstrate the hardware difference between </span>
      <span class="comment">//scrolling rotation and text backgrounds we will use</span>
      <span class="comment">//direct register access</span>

      <a name="a22"></a><a class="code" href="a00138.html#ga3f4ae1b5b9752ff1111e5a692e90fdcb" title="Background 0 horizontal scroll register (main engine).">REG_BG0HOFS</a> = sx;
      <a name="a23"></a><a class="code" href="a00138.html#ga963be0941288966259db487c881c4bd7" title="Background 0 vertical scroll register (main engine).">REG_BG0VOFS</a> = sy;

      <a class="code" href="a00096.html#ac62c34a3fa2a6403c690dd80022b3e34" title="Clears the screan by iprintf(&amp;quot;\x1b[2J&amp;quot;);.">consoleClear</a>();
      iprintf(<span class="stringliteral">&quot;Scroll x: %d Scroll y: %d\n&quot;</span>, sx, sy);
      iprintf(<span class="stringliteral">&quot;Press &#39;B&#39; to exit&quot;</span>);
   }
}
<span class="keywordtype">void</span> scrollRotation(<span class="keywordtype">void</span>)
{
   <span class="keywordtype">int</span> keys = 0;
   <span class="keywordtype">int</span> sx = 0;
   <span class="keywordtype">int</span> sy = 0;
   <span class="keywordtype">int</span> width = 512;
   <span class="keywordtype">int</span> height = 512;

   <a class="code" href="a00135.html#ae3ea5c2e57cc40d6a88e21c4dcb742c8" title="the main 2D engine video mode">videoSetMode</a>(<a name="a24"></a><a class="code" href="a00135.html#a1e46218ee302fcc8c77e4ea0968ea149a0b2ab161193b83723dd8cc633c168fab" title="4 2D backgrounds">MODE_5_2D</a>);
   <a class="code" href="a00135.html#a3e86d5c1a90d13eb82cab5d2ef6f52b2" title="Set bank A to the indicated mapping.">vramSetBankA</a>(<a class="code" href="a00135.html#a348d2824280b1b94792407f4920e346aa63f5b895f2a5f54c19babbe2b1a9fe63" title="maps vram a to main engine background slot 0.">VRAM_A_MAIN_BG</a>);

   <span class="keywordtype">int</span> bg = <a class="code" href="a00140.html#gaf2ba2b415bf8e02ccc0b30c55f878496" title="Initializes a background on the main display Sets up background control register...">bgInit</a>(3, <a name="a25"></a><a class="code" href="a00140.html#gga421d43ca799fd0c471335846da06cae1a081723a41affd32616314562b89cdbdd" title="Tiled background with 16 bit tile indexes Can be scaled and rotated.">BgType_ExRotation</a>, <a name="a26"></a><a class="code" href="a00140.html#gga6bd2253ebf93a399fa956a2a7b8b6b3bada9b7a96484ec0c981c597b9084eef8f">BgSize_ER_512x512</a>, 0,1);

   <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(TextBackgroundsTiles, <a class="code" href="a00140.html#ga8056a3c13f45f94003e90bd6a86f3a19" title="Gets a pointer to the background graphics.">bgGetGfxPtr</a>(bg), <span class="keyword">sizeof</span>(TextBackgroundsTiles));
   <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(TextBackgroundsPal, <a class="code" href="a00135.html#affd17d691136b146eea14f7f9385bbf1" title="background palette memory">BG_PALETTE</a>, <span class="keyword">sizeof</span>(TextBackgroundsPal));
   <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(Layer512x512Map, <a class="code" href="a00140.html#ga375acd93ac465dcc52650cdafb9e74ad" title="Gets a pointer to the background map.">bgGetMapPtr</a>(bg),  Layer512x512MapLen);

   <span class="keywordflow">while</span>(!(keys &amp; KEY_B))
   {
      <a class="code" href="a00109.html#af4e9294843965705093b39673ddbb2b4" title="Obtains the current keypad state. Call this function once per main loop in order...">scanKeys</a>();

      keys = <a class="code" href="a00109.html#a33346c2b7c7a610aedff2feef9a5240e" title="Obtains the current keypad held state.">keysHeld</a>();

      <span class="keywordflow">if</span>(keys &amp; KEY_UP) sy--;
      <span class="keywordflow">if</span>(keys &amp; KEY_DOWN) sy++;
      <span class="keywordflow">if</span>(keys &amp; KEY_LEFT) sx--;
      <span class="keywordflow">if</span>(keys &amp; KEY_RIGHT) sx++;

      <span class="comment">//clamp the scroll value to the map width and height</span>
      <span class="keywordflow">if</span>(sx &lt; 0) sx = 0;
      <span class="keywordflow">if</span>(sx &gt;= width - 256) sx = width - 1 - 256;
      <span class="keywordflow">if</span>(sy &lt; 0) sy = 0;
      <span class="keywordflow">if</span>(sy &gt;= height - 192) sy = height - 1 - 192;

      <a class="code" href="a00111.html#a1e8361fc4819e3f39d187dc5c29c279a" title="Wait for vblank interrupt.">swiWaitForVBlank</a>();

      <span class="comment">//normally would call bgSetScroll(id, sx, sy) here</span>
      <span class="comment">//but to demonstrate the hardware difference between </span>
      <span class="comment">//scrolling rotation and text backgrounds we will use</span>
      <span class="comment">//direct register access</span>

      <a name="a27"></a><a class="code" href="a00138.html#ga5b1de440a5d0fdb780145b200fdc1b82" title="Background 3 Screen Offset (main engine).">REG_BG3X</a> = sx &lt;&lt; 8;
      <a name="a28"></a><a class="code" href="a00138.html#gae415e8cda55a4e388e80ab2e6383ee67" title="Background 3 Screen Offset (main engine).">REG_BG3Y</a> = sy &lt;&lt; 8;

      <a class="code" href="a00096.html#ac62c34a3fa2a6403c690dd80022b3e34" title="Clears the screan by iprintf(&amp;quot;\x1b[2J&amp;quot;);.">consoleClear</a>();
      iprintf(<span class="stringliteral">&quot;Scroll x: %d Scroll y: %d\n&quot;</span>, sx, sy);
      iprintf(<span class="stringliteral">&quot;Press &#39;B&#39; to exit&quot;</span>);
   }


}
<span class="keywordtype">void</span> scrollVertical(<span class="keywordtype">void</span>)
{
   <a class="code" href="a00135.html#ae3ea5c2e57cc40d6a88e21c4dcb742c8" title="the main 2D engine video mode">videoSetMode</a>(<a class="code" href="a00135.html#a1e46218ee302fcc8c77e4ea0968ea149a9cdd63a31b19e5ff101d468d2af31fe6" title="4 2D backgrounds">MODE_0_2D</a>);
   <a class="code" href="a00135.html#a3e86d5c1a90d13eb82cab5d2ef6f52b2" title="Set bank A to the indicated mapping.">vramSetBankA</a>(<a class="code" href="a00135.html#a348d2824280b1b94792407f4920e346aa63f5b895f2a5f54c19babbe2b1a9fe63" title="maps vram a to main engine background slot 0.">VRAM_A_MAIN_BG</a>);

   <span class="keywordtype">int</span> scroll_y = 0;

   <span class="keywordtype">int</span> bg = <a class="code" href="a00140.html#gaf2ba2b415bf8e02ccc0b30c55f878496" title="Initializes a background on the main display Sets up background control register...">bgInit</a>(0, <a class="code" href="a00140.html#gga421d43ca799fd0c471335846da06cae1a6c229556bb8ab864190671ad29b4f12f" title="8bpp Tiled background with 16 bit tile indexes and no allowed rotation or scaling...">BgType_Text8bpp</a>, <a name="a29"></a><a class="code" href="a00140.html#gga6bd2253ebf93a399fa956a2a7b8b6b3bad0ae6d5acf41d75db8bc77fcb0cbb2d2">BgSize_T_256x256</a>, 0,1);

   <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(TextBackgroundsTiles, <a class="code" href="a00140.html#ga8056a3c13f45f94003e90bd6a86f3a19" title="Gets a pointer to the background graphics.">bgGetGfxPtr</a>(bg), <span class="keyword">sizeof</span>(TextBackgroundsTiles));
   <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(TextBackgroundsPal, <a class="code" href="a00135.html#affd17d691136b146eea14f7f9385bbf1" title="background palette memory">BG_PALETTE</a>, <span class="keyword">sizeof</span>(TextBackgroundsPal));

   <a name="a30"></a><a class="code" href="a00121.html#ace9d960e74685e2cd84b36132dbbf8aa" title="16 bit unsigned integer.">u16</a>* map = (<a class="code" href="a00121.html#ace9d960e74685e2cd84b36132dbbf8aa" title="16 bit unsigned integer.">u16</a>*)<a class="code" href="a00140.html#ga375acd93ac465dcc52650cdafb9e74ad" title="Gets a pointer to the background map.">bgGetMapPtr</a>(bg);

   <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(Layer256x512Map, map, 32*32*2);

   <span class="keywordtype">int</span> keys = 0;
   <span class="keywordtype">int</span> offset = 0;

   <span class="keywordflow">while</span>(!(keys &amp; KEY_B))
   {
      <a class="code" href="a00109.html#af4e9294843965705093b39673ddbb2b4" title="Obtains the current keypad state. Call this function once per main loop in order...">scanKeys</a>();

      keys = <a class="code" href="a00109.html#a33346c2b7c7a610aedff2feef9a5240e" title="Obtains the current keypad held state.">keysHeld</a>();

      <a class="code" href="a00111.html#a1e8361fc4819e3f39d187dc5c29c279a" title="Wait for vblank interrupt.">swiWaitForVBlank</a>();


      <span class="keywordflow">if</span>(keys &amp; KEY_UP)
      {
         offset = scroll_y / 8 - 1;

         <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(&amp;Layer256x512Map[(offset &amp; 63) * 32], &amp;map[(offset &amp; 31) * 32], 32 * 2);

         scroll_y--;
      }
      <span class="keywordflow">if</span>(keys &amp; KEY_DOWN)       
      {
         offset = scroll_y / 8 + 24;

         <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(&amp;Layer256x512Map[(offset &amp; 63) * 32], &amp;map[(offset &amp; 31) * 32], 32 * 2);

         scroll_y++;
      }

      <a class="code" href="a00140.html#ga70ace440e43e447bc51e2802bac2cb3e" title="Sets the scroll hardware to the specified location.">bgSetScroll</a>(bg, 0, scroll_y);
      <a class="code" href="a00140.html#ga10a22ba4815acf3e345003c1d110f872" title="Must be called once per frame to update scroll/scale/and rotation of backgrounds...">bgUpdate</a>();
   }

}
<span class="keywordtype">void</span> scrollHorizontalText(<span class="keywordtype">void</span>)
{
   <a class="code" href="a00135.html#ae3ea5c2e57cc40d6a88e21c4dcb742c8" title="the main 2D engine video mode">videoSetMode</a>(<a class="code" href="a00135.html#a1e46218ee302fcc8c77e4ea0968ea149a0b2ab161193b83723dd8cc633c168fab" title="4 2D backgrounds">MODE_5_2D</a>);
   <a class="code" href="a00135.html#a3e86d5c1a90d13eb82cab5d2ef6f52b2" title="Set bank A to the indicated mapping.">vramSetBankA</a>(<a class="code" href="a00135.html#a348d2824280b1b94792407f4920e346aa63f5b895f2a5f54c19babbe2b1a9fe63" title="maps vram a to main engine background slot 0.">VRAM_A_MAIN_BG</a>);

   <span class="keywordtype">int</span> scroll_x = 0;

   <span class="keywordtype">int</span> bg = <a class="code" href="a00140.html#gaf2ba2b415bf8e02ccc0b30c55f878496" title="Initializes a background on the main display Sets up background control register...">bgInit</a>(0, <a class="code" href="a00140.html#gga421d43ca799fd0c471335846da06cae1a6c229556bb8ab864190671ad29b4f12f" title="8bpp Tiled background with 16 bit tile indexes and no allowed rotation or scaling...">BgType_Text8bpp</a>, <a name="a31"></a><a class="code" href="a00140.html#gga6bd2253ebf93a399fa956a2a7b8b6b3badccf6c4e2ced19ed8b40b5bb6f4d4fd5">BgSize_T_512x256</a>, 0,1);

   <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(TextBackgroundsTiles, <a class="code" href="a00140.html#ga8056a3c13f45f94003e90bd6a86f3a19" title="Gets a pointer to the background graphics.">bgGetGfxPtr</a>(bg), <span class="keyword">sizeof</span>(TextBackgroundsTiles));
   <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(TextBackgroundsPal, <a class="code" href="a00135.html#affd17d691136b146eea14f7f9385bbf1" title="background palette memory">BG_PALETTE</a>, <span class="keyword">sizeof</span>(TextBackgroundsPal));

   <a class="code" href="a00121.html#ace9d960e74685e2cd84b36132dbbf8aa" title="16 bit unsigned integer.">u16</a>* map = (<a class="code" href="a00121.html#ace9d960e74685e2cd84b36132dbbf8aa" title="16 bit unsigned integer.">u16</a>*)<a class="code" href="a00140.html#ga375acd93ac465dcc52650cdafb9e74ad" title="Gets a pointer to the background map.">bgGetMapPtr</a>(bg);


   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iy = 0; iy &lt; 24; iy++)
      <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(&amp;Layer512x256Map[iy * 64], &amp;map[iy * 32], 32*2);

   <span class="keywordtype">int</span> keys = 0;
   <span class="keywordtype">int</span> layerOffset = 0;
   <span class="keywordtype">int</span> mapOffset = 0;

   <span class="keywordflow">while</span>(!(keys &amp; KEY_B))
   {
      <a class="code" href="a00109.html#af4e9294843965705093b39673ddbb2b4" title="Obtains the current keypad state. Call this function once per main loop in order...">scanKeys</a>();

      keys = <a class="code" href="a00109.html#a33346c2b7c7a610aedff2feef9a5240e" title="Obtains the current keypad held state.">keysHeld</a>();

      <a class="code" href="a00111.html#a1e8361fc4819e3f39d187dc5c29c279a" title="Wait for vblank interrupt.">swiWaitForVBlank</a>();

      <span class="keywordflow">if</span>(keys &amp; KEY_LEFT)
      {
         mapOffset = scroll_x / 8 - 1;
         layerOffset = (mapOffset &amp; 63);

         <span class="keywordflow">if</span>(layerOffset &gt;= 32) layerOffset += 32 * 32 - 32;

         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iy = 0; iy &lt; 24; iy++)
            map[layerOffset + (iy * 32)] = Layer512x256Map[(mapOffset &amp; 63) + (iy * 64)] ;

         scroll_x--;
      }
      <span class="keywordflow">if</span>(keys &amp; KEY_RIGHT)      
      {
         mapOffset = scroll_x / 8 + 32;
         layerOffset = (mapOffset &amp; 63);

         <span class="keywordflow">if</span>(layerOffset &gt;= 32) layerOffset += 32 * 32 - 32;

         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iy = 0; iy &lt; 24; iy++)
            map[layerOffset + (iy * 32)] = Layer512x256Map[(mapOffset &amp; 63) + (iy * 64)] ;

         scroll_x++;
      }


      <a class="code" href="a00140.html#ga70ace440e43e447bc51e2802bac2cb3e" title="Sets the scroll hardware to the specified location.">bgSetScroll</a>(bg, scroll_x, 0);
      <a class="code" href="a00140.html#ga10a22ba4815acf3e345003c1d110f872" title="Must be called once per frame to update scroll/scale/and rotation of backgrounds...">bgUpdate</a>();
   }

}

<span class="keywordtype">void</span> scrollHorizontalExRotation(<span class="keywordtype">void</span>)
{
   <a class="code" href="a00135.html#ae3ea5c2e57cc40d6a88e21c4dcb742c8" title="the main 2D engine video mode">videoSetMode</a>(<a class="code" href="a00135.html#a1e46218ee302fcc8c77e4ea0968ea149a0b2ab161193b83723dd8cc633c168fab" title="4 2D backgrounds">MODE_5_2D</a>);
   <a class="code" href="a00135.html#a3e86d5c1a90d13eb82cab5d2ef6f52b2" title="Set bank A to the indicated mapping.">vramSetBankA</a>(<a class="code" href="a00135.html#a348d2824280b1b94792407f4920e346aa63f5b895f2a5f54c19babbe2b1a9fe63" title="maps vram a to main engine background slot 0.">VRAM_A_MAIN_BG</a>);

   <span class="keywordtype">int</span> scroll_x = 0;

   <span class="keywordtype">int</span> bg = <a class="code" href="a00140.html#gaf2ba2b415bf8e02ccc0b30c55f878496" title="Initializes a background on the main display Sets up background control register...">bgInit</a>(3, <a class="code" href="a00140.html#gga421d43ca799fd0c471335846da06cae1a081723a41affd32616314562b89cdbdd" title="Tiled background with 16 bit tile indexes Can be scaled and rotated.">BgType_ExRotation</a>, <a class="code" href="a00140.html#gga6bd2253ebf93a399fa956a2a7b8b6b3bada9b7a96484ec0c981c597b9084eef8f">BgSize_ER_512x512</a>, 0,1);

   <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(TextBackgroundsTiles, <a class="code" href="a00140.html#ga8056a3c13f45f94003e90bd6a86f3a19" title="Gets a pointer to the background graphics.">bgGetGfxPtr</a>(bg), <span class="keyword">sizeof</span>(TextBackgroundsTiles));
   <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(TextBackgroundsPal, <a class="code" href="a00135.html#affd17d691136b146eea14f7f9385bbf1" title="background palette memory">BG_PALETTE</a>, <span class="keyword">sizeof</span>(TextBackgroundsPal));

   <a class="code" href="a00121.html#ace9d960e74685e2cd84b36132dbbf8aa" title="16 bit unsigned integer.">u16</a>* map = (<a class="code" href="a00121.html#ace9d960e74685e2cd84b36132dbbf8aa" title="16 bit unsigned integer.">u16</a>*)<a class="code" href="a00140.html#ga375acd93ac465dcc52650cdafb9e74ad" title="Gets a pointer to the background map.">bgGetMapPtr</a>(bg);

   <a name="a32"></a><a class="code" href="a00140.html#gae3f6aead9a537fc185091c3afd2781cb" title="allows direct access to background control for the chosen layer, returns a pointer...">bgSetControlBits</a>(bg, <a name="a33"></a><a class="code" href="a00137.html#gga7afc211c644079338a1f032ea5e90460a3198784885f9531d0a4f30d442ada05c" title="Enable wrapping (no effect on text backgrounds...always wrapped).">BG_WRAP_ON</a>);

   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iy = 0; iy &lt; 24; iy++)
      <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(&amp;Layer512x256Map[iy * 64], &amp;map[iy * 64], 32*2);

   <span class="keywordtype">int</span> keys = 0;
   <span class="keywordtype">int</span> offset = 0;

   <span class="keywordflow">while</span>(!(keys &amp; KEY_B))
   {
      <a class="code" href="a00109.html#af4e9294843965705093b39673ddbb2b4" title="Obtains the current keypad state. Call this function once per main loop in order...">scanKeys</a>();

      keys = <a class="code" href="a00109.html#a33346c2b7c7a610aedff2feef9a5240e" title="Obtains the current keypad held state.">keysHeld</a>();

      <a class="code" href="a00111.html#a1e8361fc4819e3f39d187dc5c29c279a" title="Wait for vblank interrupt.">swiWaitForVBlank</a>();

      <span class="keywordflow">if</span>(keys &amp; KEY_LEFT)
      {
         offset = scroll_x / 8 - 1;

         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iy = 0; iy &lt; 24; iy++)
            map[(offset &amp; 63) + (iy * 64)] = Layer512x256Map[(offset &amp; 63) + (iy * 64)] ;

         scroll_x--;
      }
      <span class="keywordflow">if</span>(keys &amp; KEY_RIGHT)      
      {
         offset = scroll_x / 8 + 32;

         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iy = 0; iy &lt; 24; iy++)
            map[(offset &amp; 63) + (iy * 64)] = Layer512x256Map[(offset &amp; 63) + (iy * 64)] ;

         scroll_x++;
      }

      <a class="code" href="a00140.html#ga70ace440e43e447bc51e2802bac2cb3e" title="Sets the scroll hardware to the specified location.">bgSetScroll</a>(bg, scroll_x, 0);
      <a class="code" href="a00140.html#ga10a22ba4815acf3e345003c1d110f872" title="Must be called once per frame to update scroll/scale/and rotation of backgrounds...">bgUpdate</a>();
   }

}
<span class="comment">//scrolls a 1024 by 1024 map on a 512x512 layer</span>
<span class="keywordtype">void</span> scroll4wayText(<span class="keywordtype">void</span>)
{
   <a class="code" href="a00135.html#ae3ea5c2e57cc40d6a88e21c4dcb742c8" title="the main 2D engine video mode">videoSetMode</a>(<a class="code" href="a00135.html#a1e46218ee302fcc8c77e4ea0968ea149a9cdd63a31b19e5ff101d468d2af31fe6" title="4 2D backgrounds">MODE_0_2D</a>);
   <a class="code" href="a00135.html#a3e86d5c1a90d13eb82cab5d2ef6f52b2" title="Set bank A to the indicated mapping.">vramSetBankA</a>(<a class="code" href="a00135.html#a348d2824280b1b94792407f4920e346aa63f5b895f2a5f54c19babbe2b1a9fe63" title="maps vram a to main engine background slot 0.">VRAM_A_MAIN_BG</a>);

   <span class="keywordtype">int</span> scroll_x = 0;
   <span class="keywordtype">int</span> scroll_y = 0;

   <span class="keyword">const</span> <span class="keywordtype">int</span> tileWidth = 8; <span class="comment">//width of a tile in pixels</span>
   <span class="keyword">const</span> <span class="keywordtype">int</span> mapWidth = 1024 / 8; <span class="comment">//width of the big map in tiles</span>
   <span class="keyword">const</span> <span class="keywordtype">int</span> mapHeight = 1024 / 8; <span class="comment">//heigh of the big map in tiles</span>
   <span class="keyword">const</span> <span class="keywordtype">int</span> bgWidth = 256 / 8; <span class="comment">//width of the hardware map in tiles</span>
   <span class="keyword">const</span> <span class="keywordtype">int</span> bgHeight = 256 / 8; <span class="comment">//height of the hardware map in tiles</span>
   <span class="keyword">const</span> <span class="keywordtype">int</span> screenWidth = 256 / 8; <span class="comment">//screen width in tiles</span>
   <span class="keyword">const</span> <span class="keywordtype">int</span> screenHeight = 192 / 8; <span class="comment">//screen height in tiles</span>


   <span class="keywordtype">int</span> bg = <a class="code" href="a00140.html#gaf2ba2b415bf8e02ccc0b30c55f878496" title="Initializes a background on the main display Sets up background control register...">bgInit</a>(3, <a class="code" href="a00140.html#gga421d43ca799fd0c471335846da06cae1a6c229556bb8ab864190671ad29b4f12f" title="8bpp Tiled background with 16 bit tile indexes and no allowed rotation or scaling...">BgType_Text8bpp</a>, <a class="code" href="a00140.html#gga6bd2253ebf93a399fa956a2a7b8b6b3badccf6c4e2ced19ed8b40b5bb6f4d4fd5">BgSize_T_512x256</a>, 0,1);

   <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(TextBackgroundsTiles, <a class="code" href="a00140.html#ga8056a3c13f45f94003e90bd6a86f3a19" title="Gets a pointer to the background graphics.">bgGetGfxPtr</a>(bg), <span class="keyword">sizeof</span>(TextBackgroundsTiles));
   <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(TextBackgroundsPal, <a class="code" href="a00135.html#affd17d691136b146eea14f7f9385bbf1" title="background palette memory">BG_PALETTE</a>, <span class="keyword">sizeof</span>(TextBackgroundsPal));

   <a class="code" href="a00121.html#ace9d960e74685e2cd84b36132dbbf8aa" title="16 bit unsigned integer.">u16</a>* bgTileMap = (<a class="code" href="a00121.html#ace9d960e74685e2cd84b36132dbbf8aa" title="16 bit unsigned integer.">u16</a>*)<a class="code" href="a00140.html#ga375acd93ac465dcc52650cdafb9e74ad" title="Gets a pointer to the background map.">bgGetMapPtr</a>(bg);
   <a class="code" href="a00121.html#ace9d960e74685e2cd84b36132dbbf8aa" title="16 bit unsigned integer.">u16</a>* bgLeftHalf = bgTileMap;
   <a class="code" href="a00121.html#ace9d960e74685e2cd84b36132dbbf8aa" title="16 bit unsigned integer.">u16</a>* bgRightHalf = bgTileMap + 32 * 32;

   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iy = 0; iy &lt; screenHeight; iy++)
      <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(&amp;Layer1024x1024Map[iy * mapWidth], &amp;bgTileMap[iy * bgWidth], screenWidth * 2);

   <span class="keywordtype">int</span> keys = 0;
   <span class="keywordtype">int</span> offset_x = 0;
   <span class="keywordtype">int</span> offset_y = 0;
   <span class="keywordtype">bool</span> movingHorizontal = <span class="keyword">false</span>;
   <span class="keywordtype">bool</span> movingVertical = <span class="keyword">false</span>;

   <span class="keywordflow">while</span>(!(keys &amp; KEY_B))
   {
      movingHorizontal = <span class="keyword">false</span>;
      movingVertical = <span class="keyword">false</span>;

      <a class="code" href="a00109.html#af4e9294843965705093b39673ddbb2b4" title="Obtains the current keypad state. Call this function once per main loop in order...">scanKeys</a>();

      keys = <a class="code" href="a00109.html#a33346c2b7c7a610aedff2feef9a5240e" title="Obtains the current keypad held state.">keysHeld</a>();

      <a class="code" href="a00111.html#a1e8361fc4819e3f39d187dc5c29c279a" title="Wait for vblank interrupt.">swiWaitForVBlank</a>();

      <span class="keywordflow">if</span>(keys &amp; KEY_LEFT)
      {
         offset_x = scroll_x / 8 - 1;
         scroll_x--;

         <span class="keywordflow">if</span>(scroll_x &lt; 0) 
            scroll_x = 0;
         <span class="keywordflow">else</span> 
            movingHorizontal = <span class="keyword">true</span>;
      }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(keys &amp; KEY_RIGHT)     
      {
         offset_x = scroll_x / 8 + screenWidth;
         scroll_x++;

         <span class="keywordflow">if</span>(scroll_x &gt;= (mapWidth - screenWidth) * tileWidth) 
            scroll_x = (mapWidth - screenWidth) * tileWidth - 1;
         <span class="keywordflow">else</span> 
            movingHorizontal = <span class="keyword">true</span>;
      }

      <span class="keywordflow">if</span>(keys &amp; KEY_UP)
      {
         offset_y = scroll_y / 8 - 1;
         scroll_y--;

         <span class="keywordflow">if</span>(scroll_y &lt; 0) 
            scroll_y = 0;
         <span class="keywordflow">else</span> 
            movingVertical = <span class="keyword">true</span>;

      }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(keys &amp; KEY_DOWN)      
      {
         offset_y = scroll_y / 8 + screenHeight;
         scroll_y++;

         <span class="keywordflow">if</span>(scroll_y &gt;= (mapHeight - screenHeight) * tileWidth) 
            scroll_y = (mapHeight - screenHeight) * tileWidth - 1;
         <span class="keywordflow">else</span> 
            movingVertical = <span class="keyword">true</span>;
      }

      <span class="keywordflow">if</span>(movingHorizontal)
      {
         <a class="code" href="a00121.html#ace9d960e74685e2cd84b36132dbbf8aa" title="16 bit unsigned integer.">u16</a>* bgTemp = ((offset_x &amp; 63) &gt;= bgWidth) ? bgRightHalf : bgLeftHalf;

         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iy = scroll_y / 8 - 1 ; iy &lt; scroll_y / 8 + screenHeight + 1; iy++)
         {  
            bgTemp[(offset_x &amp; (bgWidth - 1)) + (iy &amp; (bgHeight - 1)) * 32] = 
               Layer1024x1024Map[offset_x + iy * mapWidth]; 
         }
      }
      <span class="keywordflow">if</span>(movingVertical)
      { 
         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ix = scroll_x / 8 - 1 ; ix &lt; scroll_x / 8 + screenWidth + 1; ix++)
         {
            <a class="code" href="a00121.html#ace9d960e74685e2cd84b36132dbbf8aa" title="16 bit unsigned integer.">u16</a>* bgTemp = ((ix &amp; 63) &gt;= bgWidth) ? bgRightHalf : bgLeftHalf;

             bgTemp[(ix &amp; (bgWidth - 1)) + (offset_y &amp; (bgHeight - 1))* 32] = 
                 Layer1024x1024Map[ix + offset_y * mapWidth];   
         }
      }

      <a class="code" href="a00140.html#ga70ace440e43e447bc51e2802bac2cb3e" title="Sets the scroll hardware to the specified location.">bgSetScroll</a>(bg, scroll_x, scroll_y);
      <a class="code" href="a00140.html#ga10a22ba4815acf3e345003c1d110f872" title="Must be called once per frame to update scroll/scale/and rotation of backgrounds...">bgUpdate</a>();
   }
}

<span class="keywordtype">void</span> scroll4wayExRotation(<span class="keywordtype">void</span>)
{
   <a class="code" href="a00135.html#ae3ea5c2e57cc40d6a88e21c4dcb742c8" title="the main 2D engine video mode">videoSetMode</a>(<a class="code" href="a00135.html#a1e46218ee302fcc8c77e4ea0968ea149a0b2ab161193b83723dd8cc633c168fab" title="4 2D backgrounds">MODE_5_2D</a>);
   <a class="code" href="a00135.html#a3e86d5c1a90d13eb82cab5d2ef6f52b2" title="Set bank A to the indicated mapping.">vramSetBankA</a>(<a class="code" href="a00135.html#a348d2824280b1b94792407f4920e346aa63f5b895f2a5f54c19babbe2b1a9fe63" title="maps vram a to main engine background slot 0.">VRAM_A_MAIN_BG</a>);

   <span class="keywordtype">int</span> scroll_x = 0;
   <span class="keywordtype">int</span> scroll_y = 0;

   <span class="keyword">const</span> <span class="keywordtype">int</span> tileWidth = 8;
   <span class="keyword">const</span> <span class="keywordtype">int</span> mapWidth = 1024 / 8;
   <span class="keyword">const</span> <span class="keywordtype">int</span> mapHeight = 1024 / 8;
   <span class="keyword">const</span> <span class="keywordtype">int</span> bgWidth = 512 / 8;
   <span class="keyword">const</span> <span class="keywordtype">int</span> bgHeight = 512 / 8;
   <span class="keyword">const</span> <span class="keywordtype">int</span> screenWidth = 256 / 8;
   <span class="keyword">const</span> <span class="keywordtype">int</span> screenHeight = 192 / 8;


   <span class="keywordtype">int</span> bg = <a class="code" href="a00140.html#gaf2ba2b415bf8e02ccc0b30c55f878496" title="Initializes a background on the main display Sets up background control register...">bgInit</a>(3, <a class="code" href="a00140.html#gga421d43ca799fd0c471335846da06cae1a081723a41affd32616314562b89cdbdd" title="Tiled background with 16 bit tile indexes Can be scaled and rotated.">BgType_ExRotation</a>, <a class="code" href="a00140.html#gga6bd2253ebf93a399fa956a2a7b8b6b3bada9b7a96484ec0c981c597b9084eef8f">BgSize_ER_512x512</a>, 0,1);

   <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(TextBackgroundsTiles, <a class="code" href="a00140.html#ga8056a3c13f45f94003e90bd6a86f3a19" title="Gets a pointer to the background graphics.">bgGetGfxPtr</a>(bg), <span class="keyword">sizeof</span>(TextBackgroundsTiles));
   <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(TextBackgroundsPal, <a class="code" href="a00135.html#affd17d691136b146eea14f7f9385bbf1" title="background palette memory">BG_PALETTE</a>, <span class="keyword">sizeof</span>(TextBackgroundsPal));

   <a class="code" href="a00121.html#ace9d960e74685e2cd84b36132dbbf8aa" title="16 bit unsigned integer.">u16</a>* bgTileMap = (<a class="code" href="a00121.html#ace9d960e74685e2cd84b36132dbbf8aa" title="16 bit unsigned integer.">u16</a>*)<a class="code" href="a00140.html#ga375acd93ac465dcc52650cdafb9e74ad" title="Gets a pointer to the background map.">bgGetMapPtr</a>(bg);

   <a class="code" href="a00140.html#gae3f6aead9a537fc185091c3afd2781cb" title="allows direct access to background control for the chosen layer, returns a pointer...">bgSetControlBits</a>(bg, <a class="code" href="a00137.html#gga7afc211c644079338a1f032ea5e90460a3198784885f9531d0a4f30d442ada05c" title="Enable wrapping (no effect on text backgrounds...always wrapped).">BG_WRAP_ON</a>);

   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iy = 0; iy &lt; screenHeight; iy++)
      <a class="code" href="a00101.html#ac77a16a7cb9f2fa2b4361c22fe84245d" title="copies from source to destination using channel 3 of DMA available channels in half...">dmaCopy</a>(&amp;Layer1024x1024Map[iy * mapWidth], &amp;bgTileMap[iy * bgWidth], screenWidth * 2);

   <span class="keywordtype">int</span> keys = 0;
   <span class="keywordtype">int</span> offset_x = 0;
   <span class="keywordtype">int</span> offset_y = 0;
   <span class="keywordtype">bool</span> movingHorizontal = <span class="keyword">false</span>;
   <span class="keywordtype">bool</span> movingVertical = <span class="keyword">false</span>;

   <span class="keywordflow">while</span>(!(keys &amp; KEY_B))
   {
      movingHorizontal = <span class="keyword">false</span>;
      movingVertical = <span class="keyword">false</span>;

      <a class="code" href="a00109.html#af4e9294843965705093b39673ddbb2b4" title="Obtains the current keypad state. Call this function once per main loop in order...">scanKeys</a>();

      keys = <a class="code" href="a00109.html#a33346c2b7c7a610aedff2feef9a5240e" title="Obtains the current keypad held state.">keysHeld</a>();

      <a class="code" href="a00111.html#a1e8361fc4819e3f39d187dc5c29c279a" title="Wait for vblank interrupt.">swiWaitForVBlank</a>();

      <span class="keywordflow">if</span>(keys &amp; KEY_LEFT)
      {
         offset_x = scroll_x / 8 - 1;
         scroll_x--;

         <span class="keywordflow">if</span>(scroll_x &lt; 0) 
            scroll_x = 0;
         <span class="keywordflow">else</span> 
            movingHorizontal = <span class="keyword">true</span>;
      }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(keys &amp; KEY_RIGHT)     
      {
         offset_x = scroll_x / 8 + screenWidth;
         scroll_x++;

         <span class="keywordflow">if</span>(scroll_x &gt;= (mapWidth - screenWidth) * tileWidth) 
            scroll_x = (mapWidth - screenWidth) * tileWidth - 1;
         <span class="keywordflow">else</span> 
            movingHorizontal = <span class="keyword">true</span>;
      }

      <span class="keywordflow">if</span>(keys &amp; KEY_UP)
      {
         offset_y = scroll_y / 8 - 1;
         scroll_y--;

         <span class="keywordflow">if</span>(scroll_y &lt; 0) 
            scroll_y = 0;
         <span class="keywordflow">else</span> 
            movingVertical = <span class="keyword">true</span>;

      }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(keys &amp; KEY_DOWN)      
      {
         offset_y = scroll_y / 8 + screenHeight;
         scroll_y++;

         <span class="keywordflow">if</span>(scroll_y &gt;= (mapHeight - screenHeight) * tileWidth) 
            scroll_y = (mapHeight - screenHeight) * tileWidth - 1;
         <span class="keywordflow">else</span> 
            movingVertical = <span class="keyword">true</span>;
      }

      <span class="keywordflow">if</span>(movingHorizontal)
      {
         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iy = scroll_y / 8 - 1 ; iy &lt; scroll_y / 8 + screenHeight + 1; iy++)
            bgTileMap[(offset_x &amp; (bgWidth - 1)) + (iy &amp; (bgHeight - 1)) * bgWidth] = 
               Layer1024x1024Map[offset_x  + iy * mapWidth];    
      }
      <span class="keywordflow">if</span>(movingVertical)
      { 
         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ix = scroll_x / 8 - 1 ; ix &lt; scroll_x / 8 + screenWidth + 1; ix++)
            bgTileMap[(ix &amp; (bgWidth - 1)) + (offset_y &amp; (bgHeight - 1))* bgWidth] = 
               Layer1024x1024Map[ix + offset_y * mapWidth]; 
      }

      <a class="code" href="a00140.html#ga70ace440e43e447bc51e2802bac2cb3e" title="Sets the scroll hardware to the specified location.">bgSetScroll</a>(bg, scroll_x, scroll_y);
      <a class="code" href="a00140.html#ga10a22ba4815acf3e345003c1d110f872" title="Must be called once per frame to update scroll/scale/and rotation of backgrounds...">bgUpdate</a>();
   }
}
</pre></div> </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Mon Jul 26 10:36:03 2010 for libnds by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
